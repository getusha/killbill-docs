<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]--><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="Asciidoctor 2.0.17"><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.staticaly.com/gh/afeld/bootstrap-toc/v1.0.0/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3"><link rel="preconnect" href="https://S2ISXITURI-dsn.algolia.net"><style type="text/css"></style><title>Overdue System</title><style>/*Default CSS*/

/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */

@import "https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap";

*,
*::before,
*::after {
  -webkit-box-sizing: border-box;
  box-sizing: border-box;
}

ul,
ol {
  padding: 0;
  list-style-type: none;
}

body,
h1,
h2,
h3,
h4,
p,
ul[class],
ol[class],
li,
figure,
figcaption,
blockquote,
dl,
dd {
  margin: 0;
}

body {
  min-height: 100vh;
  scroll-behavior: smooth;
  text-rendering: optimizeSpeed;
  font-family: 'Inter', sans-serif;
  font-size: 14px;
  line-height: 150%;
  color: #374151;
  max-width: 100%;
  overflow-x: hidden;
}

ul[class],
ol[class] {
  list-style: none;
}

img {
  max-width: 100%;
  display: block;
}

button {
  cursor: pointer;
}

input,
button,
textarea,
select {
  font: inherit;
}
a,
h2,
h3,
h4 {
  color: #167BB7;
}
h1,
h3,
h4 {
  font-weight: 400;
}
h1 {
  font-size: 40px;
  line-height: 120%;
  letter-spacing: -0.025em;
  color: #FFFFFF;
}
h2 {
  font-weight: 600;
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 16px;
}

.header {
  padding: 16px 0;
  background: #FFFFFF;
  box-shadow: 0 1px 3px rgba(0, 0, 0, .1), 0 1px 2px rgba(0, 0, 0, .06);
}
.header-wrapper .logo {
  max-width: 215px;
  margin: auto;
  width: 80%;
}
.header-wrapper .search-form-wrapper {
  flex-grow: 1;
}
.header-wrapper .search-form {
  position: relative;
}
.header-wrapper .search-form .algolia-autocomplete {
  width: 100%;
}
.header-wrapper .search-form input[type="search"] {
  width: 100%;
  padding: 9px 9px 9px 40px;
  border: 1px solid #D1D5DB;
  border-radius: 6px;
  box-shadow: 0 1px 2px rgba(0, 0, 0, .05);
}
.header-wrapper .search-form .ds-dropdown-menu {
  max-width: none;
  width: 100%;
}
.header-wrapper .search-form .search-form-icon {
  position: absolute;
  left: 13px;
  top: 9px;
  z-index: 1;
  width: 20px;
  height: 20px;
  pointer-events: none;
}
.content-wrapper {
  padding: 24px 40px;
}


.content-wrapper .banner {
  position: relative;
  display: flex;
  align-items: center;
  min-height: 174px;
  margin-bottom: 24px;
  padding: 0 40px;
  background-color: #167BB7;
  border-radius: 8px;
}
.content-wrapper .banner .bg-image {
  position: absolute;
  width: 100%;
  height: 100%;
  top: 0;
  left: 0;
  pointer-events: none;
}

.main {
  line-height: 1.5;
}

.main p {
  margin-bottom: 12px;
}

.main .sidebar {
  width: 100%;
  flex-shrink: 0;
  margin-right: 40px;
  position: sticky;
  top: 0;
}

.main .sidebar .icon-title {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 18px;
  cursor: pointer;
}

.main .sidebar .icon-title .left-part{
  display: flex;
  align-items: center;
}

.main .sidebar .icon-title .chevron, .main .sidebar .icon-title.bd-link-active-wrap .chevron.rotated {
  transform: rotate(180deg);
}

.main .sidebar .icon-title.bd-link-active-wrap .bd-toc-link {
  color: #167BB7;
}

.main .sidebar .icon-title .chevron.rotated, .main .sidebar .icon-title.bd-link-active-wrap .chevron{
  transform: rotate(0);
}

.main .sidebar .bd-link-active-wrap  .chevron path {
  fill: #D1D5DB;
}

.main .sidebar .bd-link-active-wrap svg path {
  fill: #167BB7;
}

.main .sidebar .icon-title svg {
  margin-right: 8px;
}

.main .sidebar-nav,
.main .right-side-menu
{
  overflow-y: scroll;
  height: 100vh;
  padding: 24px;
}

.main .sidebar-nav {
  background-color: #FBFDFF;
  margin-left: -15px;
}

.main .right-side-menu {
  direction: rtl;
  padding: 24px 0 0 10px;
}

.main .right-side-menu .navbar-nav {
  direction: ltr;
}

.main .sidebar-nav::-webkit-scrollbar,
.main .right-side-menu::-webkit-scrollbar
{
  width: 8px;
}
 
.main .sidebar-nav::-webkit-scrollbar-track,
.main .right-side-menu::-webkit-scrollbar-track
{
  background-color: #F3F4F6;
}
 
.main .sidebar-nav::-webkit-scrollbar-thumb,
.main .right-side-menu::-webkit-scrollbar-thumb
{
  background-color: #D1D5DB;
  width: 6px;
  border-radius: 32px;
}

.main .sidebar-nav a {
  color: #1F2937;
  font-size: 12px;
}

.main .sidebar-nav a.bd-toc-link {
  font-weight: 500;
  font-size: 14px;
  display: block;
}

pre.pygments .tok-o {
  color: #167BB7;
}

.main p code {
  color: #374151;
  font-size: 14px;
}

.main table,.main table td,.main table th {
  border: 1px solid #dedede;
  padding: 10px;
}

.main .note table,.main .note table td,.main .note table th {
  border: none;
}

.main table td.icon svg{
  width: 30px;
  height: auto;
}

.main table td.icon .title {
  display: none;
}

.main table {
  width: 100%;
  border-collapse: collapse;
  margin-bottom: 15px;
}

.main table .title {
  text-transform: uppercase;
  font-weight: 600;
  padding: 0 5px;
}

pre.pygments .tok-o {
  color: #167BB7!important;
}

.main .sidebar-nav > ul li ul {
  display: none;
}

.main .sidebar-nav > ul li ul.active-list {
  display: block;
}

.main .sidebar-nav > ul li ul li a{
  display: block;
  position: relative;
  padding-left: 16px;
}

.main .sidebar-nav > ul li ul li a::before {
  content: ' ';
  position: absolute;
  top: 0;
  bottom: 0;
  left: 0;
  width: 2px;
  background-color: #EBEBEF;
}

.main .sidebar-nav > ul li ul li.list-item-active a::before {
  background-color: #167BB7;
}

.main .sidebar-nav > ul li ul li:first-child a::before {
  border-radius: 32px 32px 0px 0px;
}

.main .sidebar-nav > ul li ul li:last-child a::before {
  border-radius: 0px 0px 32px 32px;
}

.main .sidebar-nav > .navbar-nav  > li {
  margin-bottom: 26px;
}

.main .right-side-menu {
  position: sticky;
  top: 0;
  height: 100vh;
}

.main .right-side-menu > .navbar-nav {
  position: relative;
}

.main .right-side-menu > .navbar-nav:before {
  content: "In this document";
  display: block;
  color: #9CA3AF;
  font-size: 14px;
  padding-left: 10px;
}

.main .right-side-menu > ul > li > a {
  font-size: 14px;
  font-weight: 300;
  margin-bottom: 7px;
  padding: 4px 10px;
} 

.main .right-side-menu > .navbar-nav .navbar-nav li a,
.main .right-side-menu > .navbar-nav li a{
  padding-left: 15px;
}

.main .right-side-menu .nav-link {
  border: none!important;
  color: #374151!important;
}

.main .right-side-menu .nav-link.active{
  color: #167BB7!important;
}

.main .right-side-menu .navbar-nav {
  display: block;
}

.main img {
  box-shadow: 0px 4px 6px -1px rgba(0, 0, 0, 0.1), 0px 2px 4px -1px rgba(0, 0, 0, 0.06);
  border-radius: 5px;
  margin-bottom: 24px;
  margin-top: 10px;
}

.main .note img {
  box-shadow: none;
  border-radius: 0;
  min-width: 40px;
  width: 40px;
  margin-bottom: 10px;
}

.main .listingblock, .literalblock > .content pre {
  padding: 8px 14px;
  background: #50576A;
  border-radius: 4px;
  margin-bottom: 24px;
  font-size: 14px;
  font-weight: 400;
  color: #CECECE;
}

pre.pygments {
  background: #50576A!important;
  margin-bottom: 0;
}

.main .listingblock  .tok-nt {
  color: #29A9C9;
}

.main .listingblock .tok-s {
  color: #E44C3A;
}

.main .listingblock  .tok-p {
  color: #F5FBFF;
}

.main ol {
  counter-reset: my-awesome-counter;
  list-style: none;
  color: #167BB7;
  margin-left: 20px;
  margin-bottom: 16px;
}

.main ol > li {
  position: relative;
  counter-increment: my-awesome-counter;
  font-size: 10px;
  font-weight: 600;
}

.main ol> li::before {
  content: counter(my-awesome-counter); 
  width: 22px;
  height: 22px;
  border: 1px solid #167BB7;
  border-radius: 50%;
  position: absolute;
  display: flex;
  justify-content: center;
  align-items: center;
  top: 1px;
  left: -20px;
  background: transparent;
}

.main ol.arabic:first-child p {
  color: #374151;
  margin-left: 10px;
  font-size: 14px;
  font-weight: 400;
}

.main .content-wrapper ul{
  color: #374151;
  list-style: disc;
  margin-left: 20px;
}

.main .content-wrapper ul > li ul {
  list-style: circle;
}

.main .content-wrapper ul.nav-tabs{
  list-style: none;
}

.main .content-wrapper ol.loweralpha {
  list-style: none;
}

.main ol.loweralpha > li::before {
  content: ' ';
  width: 5px;
  height: 5px;
  border-radius: 50%;
  background-color: #374151;
  border: none;
  left: -5px;
  top: 8px;
}


.main h2, .main h3 {
  margin-bottom: 16px;
  padding-top: 24px;
}

.main h4 {
  margin-bottom: 16px;
  padding-top: 16px;
}

.content-wrapper h2 a, .content-wrapper h3 a, .content-wrapper h4 a {
  display: none;
  margin-left: 5px;
}

.content-wrapper h4 a svg {
  height: 14px;
  width: auto;
}

.content-wrapper h2:hover a, .content-wrapper h3:hover a, .content-wrapper h4:hover a {
  display: inline;
}

.breadcrumbs-wrapper {
  margin-bottom: 24px;
}
.breadcrumbs-list {
  display: flex;
  align-items: center;
}
.breadcrumbs-list li {
  display: flex;
  align-items: center;
}
.breadcrumbs-list li:not(:last-of-type):after {
  content: '/';
  margin-left: 6px;
  margin-right: 6px;
}
.breadcrumbs-list a {
  display: flex;
  align-items: center;
  letter-spacing: -0.025em;
  color: #374151;
}
.breadcrumbs-list a svg {
  width: 24px;
  height: 24px;
  margin-right: 4px;
}

.note table code {
  color: #374151;
}

.banner .absolute-figure {
  position: absolute;
}

.banner .absolute-figure.abstract-figure {
  right: 0;
}

.banner .absolute-figure.circle2 {
  right: 30%;
  top: 10%;
}

.banner .absolute-figure.circle3 {
  right: 15%;
  top: 10%;
}

.banner .absolute-figure.circle4 {
  left: 5%;
  top: 10%;
}

.banner .absolute-figure.circle5 {
  left: 30%;
}

.banner .absolute-figure.circle6 {
  left: 6%;
  bottom: 0;
}

.banner .absolute-figure.circle7 {
  left: 35%;
  bottom: 15%;
}

.banner .absolute-figure.circle8 {
  left: 55%;
  bottom: 0;
}

.banner .absolute-figure.circle9 {
  bottom: 0;
  right: 0;
}

.doclink {
  position: fixed;
  bottom: 0;
  padding: 0 15px 10px;
  background-color: #FBFDFF;
  z-index: 1000;
  font-size: 12px;
}

.btn-primary, .btn-primary:hover {
  background-color: #167BB7;
  border-color: #167BB7;
}

.card-wrapper .card-text {
  min-height: 80px;
}

.card-wrapper .card-body {
  padding: 1.25rem 0.25rem;
}

pre.pygments .tok-c1 {
  color: #29A9C9!important;
}

@media screen and (max-width: 1520px) {
  .card-wrapper .card-text {
    min-height: 110px;
  }
}

.DocSearch.DocSearch-Button {
    margin-left: 0;
    width: 100%;
    height: 44px;
    padding: 0 22px;
}

.DocSearch-Hit-content-wrapper {
  overflow-x: inherit !important;
}</style>
<style>pre.pygments .hll { background-color: #49483e }
pre.pygments { background: #272822; color: #f8f8f2 }
pre.pygments .tok-c { color: #75715e } /* Comment */
pre.pygments .tok-err { color: #960050; background-color: #1e0010 } /* Error */
pre.pygments .tok-k { color: #66d9ef } /* Keyword */
pre.pygments .tok-l { color: #ae81ff } /* Literal */
pre.pygments .tok-n { color: #f8f8f2 } /* Name */
pre.pygments .tok-o { color: #f92672 } /* Operator */
pre.pygments .tok-p { color: #f8f8f2 } /* Punctuation */
pre.pygments .tok-ch { color: #75715e } /* Comment.Hashbang */
pre.pygments .tok-cm { color: #75715e } /* Comment.Multiline */
pre.pygments .tok-cp { color: #75715e } /* Comment.Preproc */
pre.pygments .tok-cpf { color: #75715e } /* Comment.PreprocFile */
pre.pygments .tok-c1 { color: #75715e } /* Comment.Single */
pre.pygments .tok-cs { color: #75715e } /* Comment.Special */
pre.pygments .tok-gd { color: #f92672 } /* Generic.Deleted */
pre.pygments .tok-ge { font-style: italic } /* Generic.Emph */
pre.pygments .tok-gi { color: #a6e22e } /* Generic.Inserted */
pre.pygments .tok-go { color: #66d9ef } /* Generic.Output */
pre.pygments .tok-gp { color: #f92672; font-weight: bold } /* Generic.Prompt */
pre.pygments .tok-gs { font-weight: bold } /* Generic.Strong */
pre.pygments .tok-gu { color: #75715e } /* Generic.Subheading */
pre.pygments .tok-kc { color: #66d9ef } /* Keyword.Constant */
pre.pygments .tok-kd { color: #66d9ef } /* Keyword.Declaration */
pre.pygments .tok-kn { color: #f92672 } /* Keyword.Namespace */
pre.pygments .tok-kp { color: #66d9ef } /* Keyword.Pseudo */
pre.pygments .tok-kr { color: #66d9ef } /* Keyword.Reserved */
pre.pygments .tok-kt { color: #66d9ef } /* Keyword.Type */
pre.pygments .tok-ld { color: #e6db74 } /* Literal.Date */
pre.pygments .tok-m { color: #ae81ff } /* Literal.Number */
pre.pygments .tok-s { color: #e6db74 } /* Literal.String */
pre.pygments .tok-na { color: #a6e22e } /* Name.Attribute */
pre.pygments .tok-nb { color: #f8f8f2 } /* Name.Builtin */
pre.pygments .tok-nc { color: #a6e22e } /* Name.Class */
pre.pygments .tok-no { color: #66d9ef } /* Name.Constant */
pre.pygments .tok-nd { color: #a6e22e } /* Name.Decorator */
pre.pygments .tok-ni { color: #f8f8f2 } /* Name.Entity */
pre.pygments .tok-ne { color: #a6e22e } /* Name.Exception */
pre.pygments .tok-nf { color: #a6e22e } /* Name.Function */
pre.pygments .tok-nl { color: #f8f8f2 } /* Name.Label */
pre.pygments .tok-nn { color: #f8f8f2 } /* Name.Namespace */
pre.pygments .tok-nx { color: #a6e22e } /* Name.Other */
pre.pygments .tok-py { color: #f8f8f2 } /* Name.Property */
pre.pygments .tok-nt { color: #f92672 } /* Name.Tag */
pre.pygments .tok-nv { color: #f8f8f2 } /* Name.Variable */
pre.pygments .tok-ow { color: #f92672 } /* Operator.Word */
pre.pygments .tok-w { color: #f8f8f2 } /* Text.Whitespace */
pre.pygments .tok-mb { color: #ae81ff } /* Literal.Number.Bin */
pre.pygments .tok-mf { color: #ae81ff } /* Literal.Number.Float */
pre.pygments .tok-mh { color: #ae81ff } /* Literal.Number.Hex */
pre.pygments .tok-mi { color: #ae81ff } /* Literal.Number.Integer */
pre.pygments .tok-mo { color: #ae81ff } /* Literal.Number.Oct */
pre.pygments .tok-sa { color: #e6db74 } /* Literal.String.Affix */
pre.pygments .tok-sb { color: #e6db74 } /* Literal.String.Backtick */
pre.pygments .tok-sc { color: #e6db74 } /* Literal.String.Char */
pre.pygments .tok-dl { color: #e6db74 } /* Literal.String.Delimiter */
pre.pygments .tok-sd { color: #e6db74 } /* Literal.String.Doc */
pre.pygments .tok-s2 { color: #e6db74 } /* Literal.String.Double */
pre.pygments .tok-se { color: #ae81ff } /* Literal.String.Escape */
pre.pygments .tok-sh { color: #e6db74 } /* Literal.String.Heredoc */
pre.pygments .tok-si { color: #e6db74 } /* Literal.String.Interpol */
pre.pygments .tok-sx { color: #e6db74 } /* Literal.String.Other */
pre.pygments .tok-sr { color: #e6db74 } /* Literal.String.Regex */
pre.pygments .tok-s1 { color: #e6db74 } /* Literal.String.Single */
pre.pygments .tok-ss { color: #e6db74 } /* Literal.String.Symbol */
pre.pygments .tok-bp { color: #f8f8f2 } /* Name.Builtin.Pseudo */
pre.pygments .tok-fm { color: #a6e22e } /* Name.Function.Magic */
pre.pygments .tok-vc { color: #f8f8f2 } /* Name.Variable.Class */
pre.pygments .tok-vg { color: #f8f8f2 } /* Name.Variable.Global */
pre.pygments .tok-vi { color: #f8f8f2 } /* Name.Variable.Instance */
pre.pygments .tok-vm { color: #f8f8f2 } /* Name.Variable.Magic */
pre.pygments .tok-il { color: #ae81ff } /* Literal.Number.Integer.Long */</style></head><body data-spy="scroll" data-target="#toc" class="book"><header class="header"><div class="header-wrapper"><div class="container-fluid"><div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2"><div class="logo"><a href="https://docs.killbill.io"><img src="https://github.com/killbill/killbill-docs/raw/v3/userguide/assets/img/logo.png" style="height:41px" alt="KillBill Docs"></a></div></div><div class="col-12 col-md-9 col-xl-8"><div class="search-form-wrapper"><div id="docsearch" style="height: 43px; display: flex; align-items: center; width: 100%;"></div></div></div></div></div></div></header><main class="main"><div class="container-fluid"><div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2"><aside class="sidebar"><nav class="sidebar-nav"><ul class="nav navbar-nav"><li><div class="icon-title"><div class="left-part"><svg width="10" height="14" viewBox="0 0 10 14" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M6.90917 4.38381C7.48877 4.71836 7.68958 5.46766 7.35422 6.04827C7.01967 6.62787 6.27159 6.82767 5.69077 6.49313C5.11238 6.15878 4.91036 5.41069 5.24491 4.83008C5.58027 4.25028 6.32957 4.04947 6.90917 4.38381ZM6.37381 1.42682C5.15844 2.43471 4.17924 3.6026 3.49318 4.9216C2.6261 6.58828 2.636 7.89395 2.68287 9.01315C2.69054 9.18244 2.70408 9.33517 2.72186 9.478L3.06913 9.67901L3.70671 8.34829C3.82348 8.08627 4.03177 7.8495 4.37157 7.89172L3.0154 10.5251C2.87135 10.7976 3.33116 11.0691 3.51095 10.8113L3.94773 10.1861L4.54086 10.5281C4.68066 10.4764 4.82814 10.4166 4.98713 10.3439C6.00633 9.87679 7.12371 9.18446 8.12635 7.59697C8.94777 6.29656 9.5003 4.76463 9.71303 3.35492C9.11646 3.2434 8.4914 3.0139 7.88534 2.6638C7.27967 2.31471 6.76836 1.88743 6.37381 1.42682Z" fill="#D1D5DB"/><path fill-rule="evenodd" clip-rule="evenodd" d="M8.00529 8.78265C8.02732 8.90811 8.0455 9.02064 8.06327 9.14145C8.20025 10.1031 8.10226 10.7689 7.75196 11.3384C7.26791 12.1251 6.42306 12.6134 5.47962 13.1582C5.29739 13.2613 5.07133 13.1245 5.08183 12.9154L5.17739 10.8964C6.19578 10.6122 7.13135 9.9063 8.00529 8.78265Z" fill="#D1D5DB"/><path fill-rule="evenodd" clip-rule="evenodd" d="M9.39098 0.0548899C9.24775 0.0138795 9.10815 0.0559002 8.98371 0.0886278C8.22936 0.285599 7.52147 0.626208 6.86914 1.06601C7.21197 1.4551 7.65905 1.82783 8.19057 2.13491C8.72289 2.44198 9.26775 2.64299 9.77603 2.74501C9.83058 1.95915 9.77179 1.1753 9.56573 0.424388C9.53179 0.300953 9.49724 0.157921 9.39098 0.0548899Z" fill="#D1D5DB"/><path fill-rule="evenodd" clip-rule="evenodd" d="M2.5275 5.62018C2.4075 5.6622 2.30022 5.70321 2.18648 5.74967C1.28587 6.11129 0.757784 6.52907 0.440004 7.11615C0.00100999 7.92929 0 8.90445 0 9.99456C0.00101011 10.2041 0.233739 10.3313 0.409296 10.2176L2.10931 9.12465C1.84668 8.10202 1.99072 6.93837 2.5275 5.62018Z" fill="#D1D5DB"/><path d="M2.16122 9.85376C1.46162 10.2578 1.0198 11.0194 0.863028 11.7982C0.706461 12.5776 1.00586 13.6433 1.41233 13.8778C1.81799 14.1114 2.89032 13.839 3.48689 13.3132C4.08366 12.7879 4.52225 12.0253 4.52225 11.2162L4.09518 10.9699C4.07821 12.0758 2.70628 13.0237 1.94243 12.9596C1.50485 12.3303 1.6394 10.6681 2.58971 10.1L2.16122 9.85376Z" fill="#D1D5DB"/></svg><a class="bd-toc-link main-link">Getting Started</a></div><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li><a class="nav-link" href="/latest/what_is_kill_bill.html">What is Kill Bill?</a></li><li><a class="nav-link" href="/latest/getting_started.html">Quick Start</a></li></ul></li><li><div class="icon-title"><div class="left-part"><svg width="17" height="14" viewBox="0 0 17 14" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M11.8468 6.75106L8.27233 10.4574C8.20425 10.5128 8.10212 10.5681 7.99999 10.5681C7.89787 10.5681 7.79574 10.5404 7.72765 10.4574L4.15319 6.75106C4.0851 6.66808 4.05106 6.55745 4.11914 6.44681C4.18723 6.33617 4.28936 6.30851 4.42553 6.30851H6.12765V0.776596C6.12765 0.610638 6.26382 0.5 6.46808 0.5H9.53191C9.73616 0.5 9.87233 0.610638 9.87233 0.776596V6.30851H11.5745C11.7106 6.30851 11.8128 6.36383 11.8808 6.47447C11.9489 6.58511 11.9149 6.66808 11.8468 6.75106Z" fill="#D1D5DB"/><path d="M16.3404 11.0107V13.2234C16.3404 13.3894 16.2043 13.5 16 13.5H0.340426C0.13617 13.5 0 13.3894 0 13.2234V11.0107C0 10.8447 0.13617 10.7341 0.340426 10.7341H16C16.2043 10.7341 16.3404 10.8447 16.3404 11.0107Z" fill="#D1D5DB"/></svg><a class="bd-toc-link main-link">Installation</a></div><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="/latest/aws.html">AWS Development</a></li><li><a class="nav-link" href="/latest/stripe_plugin.html">Kill Bill + Stripe DIY</a></li><li><a class="nav-link" href="/latest/userguide_deployment.html">Going to Production</a></li><li><a class="nav-link" href="/latest/database_migrations.html">Database Migrations</a></li><li><a class="nav-link" href="/latest/PostgreSQL.html">PostgreSQL Setup</a></li><li><a class="nav-link" href="https://github.com/killbill/killbill/releases" onclick="getOutboundLink('https://github.com/killbill/killbill/releases'); return false;">Release&nbsp;Notes</a></li></ul></li><li><div class="icon-title"><div class="left-part"><svg width="13" height="14" viewBox="0 0 13 14" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M1.35868 0.5C0.606463 0.5 0 1.17607 0 2.01667V11.9833C0 12.8239 0.606463 13.5 1.35868 13.5H10.9191C11.3384 13.5 11.7131 13.2901 11.9618 12.9583H1.21424C0.819297 12.9583 0.501042 12.6094 0.501042 12.1774V11.0309C0.501042 10.599 0.819297 10.25 1.21424 10.25H12.2778V2.01667C12.2778 1.17607 11.6713 0.5 10.9191 0.5H1.35868ZM6.13889 2.00313C6.47622 2.00313 6.74826 2.30735 6.74826 2.68924V3.00069C6.90076 3.04556 7.04926 3.10578 7.18611 3.18125L7.40729 2.96007C7.54231 2.82505 7.71081 2.75369 7.87674 2.7434C8.04266 2.73312 8.20435 2.78664 8.32361 2.9059C8.56214 3.14443 8.53948 3.5567 8.26944 3.82674L8.05278 4.0434C8.1282 4.18032 8.18399 4.3287 8.22882 4.48125H8.54028C8.92216 4.48125 9.2309 4.7533 9.2309 5.09063C9.2309 5.42796 8.92216 5.7 8.54028 5.7H8.22882C8.18378 5.85322 8.12417 6.00042 8.04826 6.13785L8.26944 6.35903C8.53948 6.62907 8.56214 7.03684 8.32361 7.27536C8.08508 7.51389 7.67732 7.49123 7.40729 7.22119L7.18611 7C7.04861 7.07596 6.90158 7.14003 6.74826 7.18508V7.49202C6.74826 7.87391 6.47622 8.18264 6.13889 8.18264C5.80156 8.18264 5.52951 7.87391 5.52951 7.49202V7.18508C5.37616 7.14003 5.22922 7.07596 5.09167 7L4.87049 7.22119C4.60045 7.49123 4.1927 7.51389 3.95417 7.27536C3.71564 7.03684 3.7383 6.62907 4.00833 6.35903L4.22951 6.13785C4.15354 6.00042 4.09404 5.85322 4.04896 5.7H3.7375C3.35562 5.7 3.04687 5.42796 3.04687 5.09063C3.04687 4.7533 3.35562 4.48125 3.7375 4.48125H4.04896C4.09383 4.3287 4.14952 4.18032 4.225 4.0434L4.00833 3.82674C3.7383 3.5567 3.71564 3.14443 3.95417 2.9059C4.05852 2.80154 4.19405 2.74834 4.33785 2.7434C4.52272 2.73705 4.71859 2.80818 4.87049 2.96007L5.09167 3.18125C5.22858 3.10578 5.37698 3.04556 5.52951 3.00069V2.68924C5.52951 2.30735 5.80156 2.00313 6.13889 2.00313ZM6.13889 3.81319C5.42639 3.81319 4.85694 4.37813 4.85694 5.09063C4.85694 5.80311 5.42639 6.37257 6.13889 6.37257C6.85138 6.37257 7.42083 5.80311 7.42083 5.09063C7.42083 4.37813 6.85138 3.81319 6.13889 3.81319Z" fill="#D1D5DB"/></svg><a class="bd-toc-link main-link">Manuals</a></div><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg>  </div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="/latest/userguide_subscription.html">Subscription&nbsp;Billing</a></li><li><a class="nav-link" href="/latest/userguide_payment.html">Payment Processing</a></li><li><a class="nav-link" href="/latest/userguide_kaui.html">Kaui, the Administrative&nbsp;UI</a></li><li><a class="nav-link" href="/latest/email-notification-plugin.html">Email Notification Plugin</a></li><li><a class="nav-link" href="/latest/custom-email-invoice-formatter.html">Custom Email Formatter</a></li><li><a class="nav-link" href="/latest/userguide_analytics.html">Analytics Plugin</a></li><li><a class="nav-link" href="/latest/userguide_configuration.html">Kill Bill&nbsp;Configuration</a></li><li><a class="nav-link" href="/latest/internationalization.html">Kill Bill&nbsp;Internationalization</a></li><li><a class="nav-link" href="/latest/migration_guide.html">Migrating to Kill Bill</a></li></ul></li><li><div class="icon-title"><div class="left-part"><svg width="13" height="14" viewBox="0 0 13 14" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.49995 13.5C2.91587 13.5 0 10.5841 0 7C0 3.41587 2.91587 0.5 6.49995 0.5C8.45326 0.5 10.2851 1.36667 11.5258 2.8778C11.7667 3.17111 11.7241 3.60417 11.4308 3.84503C11.1375 4.08589 10.7044 4.04334 10.4635 3.74997C9.48493 2.55805 8.04027 1.87445 6.5 1.87445C3.67374 1.87445 1.37445 4.17374 1.37445 7C1.37445 9.82626 3.67374 12.1255 6.49995 12.1255C8.27513 12.1255 9.89929 11.2265 10.8446 9.7207C11.0464 9.39919 11.4707 9.30215 11.792 9.50403C12.1135 9.70586 12.2104 10.13 12.0086 10.4514C10.8104 12.3604 8.75102 13.5 6.49995 13.5Z" fill="#D1D5DB"/><path d="M5.61713 4.03134L9.16228 6.99994L5.61713 9.69408V4.03134Z" fill="#D1D5DB"/></svg><a class="bd-toc-link main-link">Tutorials</a></div><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg>  </div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="/latest/plan_alignment.html">Plans Alignments</a></li><li><a class="nav-link" href="/latest/overdue.html">Overdue System</a></li><li><a class="nav-link" href="/latest/consumable_in_arrear.html">In Arrear UsageBilling</a></li><li><a class="nav-link" href="/latest/ha.html">Hierarchical Accounts</a></li><li><a class="nav-link" href="/latest/catalog-examples.html">Catalog Examples </a></li><li><a class="nav-link" href="/latest/invoice_examples.html">Invoice Examples               </a></li><li><a class="nav-link" href="/latest/invoice_templates.html">Invoice Templates</a></li></ul></li><li><div class="icon-title"><div class="left-part"><svg width="13" height="14" viewBox="0 0 13 14" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M5.57375 4.2212C5.57375 3.55495 5.7525 2.93745 6.06125 2.38495C5.89875 2.3687 5.73625 2.35245 5.57375 2.35245C2.5025 2.35245 0 4.85495 0 7.9262C0 10.9974 2.5025 13.4999 5.57375 13.4999C8.645 13.4999 11.1475 10.9974 11.1475 7.9262C11.1475 7.7637 11.1313 7.6012 11.115 7.4387C10.5788 7.74745 9.945 7.9262 9.27875 7.9262C7.23125 7.9262 5.57375 6.2687 5.57375 4.2212Z" fill="#D1D5DB"/><path d="M12.9999 4.22131C12.9999 2.15756 11.3424 0.500061 9.27867 0.500061C7.89742 0.500061 6.69492 1.26381 6.04492 2.38506C8.74242 2.61256 10.8874 4.75756 11.1149 7.43881C12.2362 6.80506 12.9999 5.60256 12.9999 4.22131Z" fill="#D1D5DB"/></svg><a class="bd-toc-link main-link">Integration</a></div><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg>  </div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="http://killbill.github.io/slate" onclick="getOutboundLink('http://killbill.github.io/slate'); return false;">REST API Reference</a></li><li><a class="nav-link" href="/latest/swagger_documentation.html">Swagger UI Documentation</a></li><li><a class="nav-link" href="/latest/postman.html">Postman Integration</a></li><li><a class="nav-link" href="/latest/debugging.html">Debugging</a></li><li><a class="nav-link" href="/latest/push_notifications.html">Push Notifications</a></li><li><a class="nav-link" href="/latest/kill_bill_events.html">Kill Bill Events</a></li></ul></li><li><div class="icon-title"><div class="left-part"><svg width="16" height="10" viewBox="0 0 16 10" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M0.598381 4.97132L7.58645 7.95203C7.70867 8.00387 7.84006 8.03059 7.97282 8.03061C8.10557 8.03062 8.23697 8.00393 8.3592 7.95213L15.3398 4.97441C15.5165 4.89902 15.6673 4.77357 15.7736 4.61353C15.8799 4.45349 15.9371 4.26585 15.9381 4.07372C15.9391 3.88159 15.8838 3.69337 15.7791 3.53225C15.6745 3.37113 15.525 3.24415 15.349 3.16696L8.32017 0.0827333C8.19473 0.0278808 8.05926 -0.000292665 7.92236 2.29226e-06C7.78545 0.00029725 7.65011 0.0290541 7.52491 0.0844465L0.585304 3.1655C0.41 3.24329 0.261228 3.37058 0.157256 3.53174C0.0532838 3.6929 -0.00136296 3.88091 2.58277e-05 4.07269C0.00141462 4.26448 0.0587786 4.45168 0.165074 4.61132C0.271369 4.77095 0.421969 4.89607 0.598381 4.97132Z" fill="#D1D5DB"/><path d="M15.2045 5.24602L8.43625 8.13319C8.28965 8.19539 8.13202 8.22745 7.97276 8.22745C7.8135 8.22745 7.65587 8.19539 7.50926 8.13319L0.734671 5.24342C0.664526 5.21351 0.587206 5.2046 0.512096 5.21778C0.436987 5.23096 0.367319 5.26566 0.311548 5.31767C0.192258 5.42962 0.102749 5.56954 0.0511137 5.72477C-0.000521577 5.88 -0.0126555 6.04566 0.0158087 6.20676C0.0442728 6.36786 0.112438 6.51933 0.214141 6.64747C0.315844 6.77561 0.44788 6.87638 0.598311 6.94068L7.58638 9.9214C7.7086 9.97323 7.83999 9.99996 7.97275 9.99997C8.1055 9.99999 8.2369 9.9733 8.35913 9.92149L15.3397 6.94377C15.4901 6.87948 15.6222 6.77873 15.724 6.65062C15.8257 6.52251 15.894 6.37107 15.9226 6.20998C15.9512 6.04889 15.9392 5.88322 15.8877 5.72792C15.8362 5.57262 15.7469 5.43258 15.6278 5.32044C15.572 5.26841 15.5023 5.23368 15.4272 5.22047C15.352 5.20726 15.2747 5.21613 15.2045 5.24602Z" fill="#D1D5DB"/></svg><a class="bd-toc-link main-link">Plugin Development</a></div><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg>  </div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="/latest/plugin_introduction.html">Plugin Introduction</a></li><li class="bd-sidenav-active"><a class="nav-link" href="/latest/plugin_development.html">Plugin Development</a></li><li class="bd-sidenav-active"><a class="nav-link" href="/latest/plugin_installation.html">Plugin Installation</a></li><li><a class="nav-link" href="/latest/plugin_use_cases.html">Special Plugin Use Cases</a></li><li><a class="nav-link" href="/latest/notification_plugin.html">Notification Plugins</a></li><li><a class="nav-link" href="/latest/payment_plugin.html">Payment Plugins</a></li><li><a class="nav-link" href="/latest/payment_control_plugin.html">Payment Control Plugins</a></li><li><a class="nav-link" href="/latest/invoice_plugin.html">Invoice Plugins</a></li><li><a class="nav-link" href="/latest/catalog_plugin.html">Catalog Plugins</a></li><li><a class="nav-link" href="/latest/entitlement_plugin.html">Entitlement Plugins</a></li></ul></li><li><div class="icon-title"><div class="left-part"><svg width="13" height="14" viewBox="0 0 13 14" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M0.8125 1.43854L0 2.65295V12.9273L0.8125 12.1148V1.43854Z" fill="#D1D5DB"/><path d="M1.38532 12.6875L0.572815 13.5H8.41751C8.15229 13.2676 7.92719 12.9931 7.75126 12.6875H1.38532Z" fill="#D1D5DB"/><path d="M7.3125 11.0625C7.31412 10.2712 7.60357 9.50761 8.12684 8.91407C8.6501 8.32054 9.37144 7.93766 10.1562 7.83687V0.5H1.625V11.875H7.41406C7.34709 11.6093 7.31298 11.3365 7.3125 11.0625ZM2.4375 6.59375V1.71875C2.43782 1.6111 2.48072 1.50796 2.55684 1.43184C2.63296 1.35572 2.7361 1.31282 2.84375 1.3125H8.9375C9.04515 1.31282 9.14829 1.35572 9.22441 1.43184C9.30053 1.50796 9.34343 1.6111 9.34375 1.71875V6.59375C9.34343 6.7014 9.30053 6.80454 9.22441 6.88066C9.14829 6.95678 9.04515 6.99968 8.9375 7H2.84375C2.7361 6.99968 2.63296 6.95678 2.55684 6.88066C2.48072 6.80454 2.43782 6.7014 2.4375 6.59375Z" fill="#D1D5DB"/><path d="M10.9688 8.66155C10.7001 8.61282 10.4249 8.61282 10.1563 8.66155C9.58834 8.7567 9.07257 9.05017 8.70064 9.48979C8.32872 9.9294 8.12476 10.4867 8.12501 11.0625C8.12429 11.3396 8.17241 11.6146 8.26718 11.875C8.36841 12.1773 8.53326 12.4543 8.75063 12.6875C9.11573 13.1004 9.61229 13.3745 10.1563 13.4634C10.4249 13.5122 10.7001 13.5122 10.9688 13.4634C11.5366 13.368 12.0522 13.0745 12.4241 12.6349C12.7959 12.1954 13 11.6383 13 11.0625C13 10.4867 12.7959 9.92959 12.4241 9.49003C12.0522 9.05047 11.5366 8.75693 10.9688 8.66155ZM10.9688 12.2812C10.9688 12.389 10.926 12.4923 10.8498 12.5685C10.7736 12.6447 10.6703 12.6875 10.5625 12.6875C10.4548 12.6875 10.3514 12.6447 10.2752 12.5685C10.1991 12.4923 10.1563 12.389 10.1563 12.2812V11.0625C10.1563 10.9548 10.1991 10.8514 10.2752 10.7752C10.3514 10.6991 10.4548 10.6563 10.5625 10.6563C10.6703 10.6563 10.7736 10.6991 10.8498 10.7752C10.926 10.8514 10.9688 10.9548 10.9688 11.0625V12.2812ZM10.9606 9.925C10.9562 9.95046 10.948 9.97511 10.9363 9.99812C10.9274 10.024 10.9151 10.0486 10.8997 10.0712L10.851 10.1322C10.7731 10.2064 10.6701 10.2484 10.5625 10.25C10.5353 10.2493 10.5081 10.2466 10.4813 10.2419C10.4558 10.2375 10.4311 10.2292 10.4081 10.2175C10.3822 10.2086 10.3576 10.1963 10.335 10.1809L10.2741 10.1322L10.2253 10.0712C10.2099 10.0486 10.1976 10.024 10.1888 9.99812C10.177 9.97511 10.1688 9.95046 10.1644 9.925C10.1597 9.89816 10.157 9.871 10.1563 9.84375C10.1569 9.79066 10.1679 9.7382 10.1888 9.68937C10.2094 9.64016 10.2382 9.59482 10.2741 9.55531C10.3313 9.49905 10.4038 9.46094 10.4826 9.44576C10.5614 9.43059 10.6429 9.43902 10.7169 9.47C10.7673 9.48829 10.813 9.51741 10.8509 9.55532C10.8889 9.59323 10.918 9.63899 10.9363 9.68939C10.9571 9.73822 10.9682 9.79067 10.9688 9.84377C10.9681 9.87101 10.9653 9.89816 10.9606 9.925Z" fill="#D1D5DB"/><path d="M3.25 6.1875H8.53125V2.125H3.25V6.1875ZM4.46875 2.9375H7.3125C7.42024 2.9375 7.52358 2.9803 7.59976 3.05649C7.67595 3.13267 7.71875 3.23601 7.71875 3.34375C7.71875 3.45149 7.67595 3.55483 7.59976 3.63101C7.52358 3.7072 7.42024 3.75 7.3125 3.75H4.46875C4.36101 3.75 4.25767 3.7072 4.18149 3.63101C4.1053 3.55483 4.0625 3.45149 4.0625 3.34375C4.0625 3.23601 4.1053 3.13267 4.18149 3.05649C4.25767 2.9803 4.36101 2.9375 4.46875 2.9375ZM4.46875 4.5625H7.3125C7.42024 4.5625 7.52358 4.6053 7.59976 4.68149C7.67595 4.75767 7.71875 4.86101 7.71875 4.96875C7.71875 5.07649 7.67595 5.17983 7.59976 5.25601C7.52358 5.3322 7.42024 5.375 7.3125 5.375H4.46875C4.36101 5.375 4.25767 5.3322 4.18149 5.25601C4.1053 5.17983 4.0625 5.07649 4.0625 4.96875C4.0625 4.86101 4.1053 4.75767 4.18149 4.68149C4.25767 4.6053 4.36101 4.5625 4.46875 4.5625Z" fill="#D1D5DB"/></svg><a class="bd-toc-link main-link">Operational Guides</a></div><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg>  </div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="/latest/deploy_to_kubernetes.html">Kubernetes (K8s) Deployment</a></li><li class="bd-sidenav-active"><a class="nav-link" href="/latest/user_management.html">Users, Roles, and Permissions</a></li><li><a class="nav-link" href="/latest/plugin_management.html">Plugin Management</a></li><li><a class="nav-link" href="/latest/aws-tools.html">AWS Analytics Tools</a></li></ul></li><li><div class="icon-title"><div class="left-part"><svg width="13" height="14" viewBox="0 0 13 14" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M1.76912 2.78244C1.76912 2.33102 1.90298 1.88973 2.15378 1.51439C2.40458 1.13904 2.76105 0.846493 3.17811 0.673741C3.59517 0.500989 4.0541 0.455789 4.49685 0.543858C4.9396 0.631927 5.34629 0.849309 5.6655 1.16851C5.9847 1.48772 6.20209 1.89441 6.29015 2.33716C6.37822 2.77991 6.33302 3.23884 6.16027 3.6559C5.98752 4.07296 5.69497 4.42943 5.31962 4.68023C4.94428 4.93103 4.50299 5.06489 4.05157 5.06489C3.75183 5.06489 3.45503 5.00586 3.17811 4.89115C2.90119 4.77645 2.64957 4.60833 2.43763 4.39638C2.22568 4.18443 2.05756 3.93282 1.94286 3.6559C1.82815 3.37898 1.76912 3.08218 1.76912 2.78244ZM13 12.4292C13 10.5255 11.0766 8.98227 8.70388 8.98227C6.33121 8.98227 4.40776 10.5255 4.40776 12.4292C4.40776 13.1431 6.55582 13.5 8.70388 13.5C10.8519 13.5 13 13.1431 13 12.4292ZM4.05157 10.0356C4.33129 10.0356 4.61081 10.0289 4.88519 10.0161C5.63217 9.24511 6.60633 8.73355 7.66506 8.55627C7.15108 8.36153 6.70189 8.02679 6.36832 7.58995C6.03475 7.15311 5.83013 6.63161 5.77762 6.0845C5.22568 5.87794 4.64089 5.77307 4.05157 5.77497C1.81395 5.77497 0 7.23039 0 9.02568C0 9.69892 2.02578 10.0356 4.05157 10.0356ZM8.70388 8.22931C9.18255 8.22931 9.65047 8.08737 10.0485 7.82143C10.4465 7.55549 10.7567 7.1775 10.9399 6.73527C11.123 6.29303 11.171 5.80641 11.0776 5.33693C10.9842 4.86746 10.7537 4.43622 10.4152 4.09775C10.0767 3.75928 9.6455 3.52878 9.17602 3.43539C8.70655 3.34201 8.21993 3.38994 7.77769 3.57312C7.33546 3.7563 6.95747 4.0665 6.69154 4.46451C6.4256 4.86251 6.28366 5.33043 6.28366 5.8091C6.28366 6.12693 6.34626 6.44164 6.46789 6.73528C6.58951 7.02891 6.76779 7.29572 6.99253 7.52045C7.21726 7.74519 7.48407 7.92346 7.7777 8.04509C8.07134 8.16671 8.38605 8.22931 8.70388 8.22931Z" fill="#D1D5DB"/></svg><a class="bd-toc-link main-link">Client Libraries</a></div><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg>  </div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="/latest/java_client.html">Java</a></li><li><a class="nav-link" href="http://github.com/killbill/killbill-client-ruby" onclick="getOutboundLink('http://github.com/killbill/killbill-client-ruby'); return false;">Ruby</a></li><li><a class="nav-link" href="http://github.com/killbill/killbill-client-php" onclick="getOutboundLink('http://github.com/killbill/killbill-client-php'); return false;">PHP</a></li><li><a class="nav-link" href="http://github.com/killbill/killbill-client-js" onclick="getOutboundLink('http://github.com/killbill/killbill-client-js'); return false;">Node.js</a></li><li><a class="nav-link" href="http://github.com/killbill/killbill-client-python" onclick="getOutboundLink('http://github.com/killbill/killbill-client-python'); return false;">Python</a></li><li><a class="nav-link" href="http://github.com/killbill/kbcli" onclick="getOutboundLink('http://github.com/killbill/kbcli'); return false;">Go</a></li></ul></li><li><div class="icon-title"><div class="left-part"><svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7.41355 4.58645C7.0354 4.208 6.53345 4 6 4C4.8972 4 4 4.89695 4 6C4 7.10305 4.8972 8 6 8C7.1028 8 8 7.10305 8 6C8 5.4668 7.79175 4.96435 7.41355 4.58645Z" fill="#D1D5DB"/><path d="M10.5772 9.8704C11.463 8.8246 12 7.47465 12 6C12 4.52535 11.463 3.1754 10.5772 2.1296L11.1267 1.5801C11.2243 1.48245 11.2243 1.3242 11.1267 1.22655L10.7732 0.8731C10.6756 0.77545 10.5173 0.77545 10.4196 0.8731L9.87015 1.4226C8.8244 0.53695 7.4745 0 6 0C4.5255 0 3.1756 0.53695 2.1298 1.4226L1.58035 0.8731C1.4827 0.77545 1.3244 0.77545 1.22675 0.8731L0.87325 1.22655C0.7756 1.3242 0.7756 1.48245 0.87325 1.5801L1.4227 2.1296C0.537 3.1754 0 4.52535 0 6C0 7.47465 0.537 8.8246 1.42275 9.8704L0.8733 10.4199C0.77565 10.5175 0.77565 10.6758 0.8733 10.7734L1.2268 11.127C1.32445 11.2246 1.4827 11.2246 1.5804 11.127L2.12985 10.5774C3.1756 11.463 4.5255 12 6 12C7.4745 12 8.8244 11.463 9.8702 10.5774L10.4197 11.1269C10.5173 11.2245 10.6756 11.2245 10.7732 11.1269L11.1267 10.7734C11.2244 10.6758 11.2244 10.5175 11.1267 10.4199L10.5772 9.8704ZM6 11C4.8012 11 3.70025 10.5752 2.83795 9.86915L3.70165 9.00535C3.7993 8.9077 3.7993 8.74945 3.70165 8.6518L3.34815 8.29835C3.2505 8.2007 3.09225 8.2007 2.99455 8.29835L2.13085 9.16215C1.42485 8.29985 1 7.1988 1 6C1 4.8012 1.4248 3.70015 2.1309 2.83785L2.9946 3.70165C3.09225 3.7993 3.25055 3.7993 3.3482 3.70165L3.7017 3.34815C3.79935 3.2505 3.79935 3.09225 3.7017 2.9946L2.83795 2.13085C3.70025 1.42485 4.8012 1 6 1C7.1988 1 8.29975 1.42485 9.16205 2.13085L8.29835 2.9946C8.2007 3.09225 8.2007 3.2505 8.29835 3.34815L8.65185 3.70165C8.7495 3.7993 8.90775 3.7993 9.00545 3.70165L9.86915 2.83785C10.5752 3.70015 11 4.8012 11 6C11 7.1988 10.5751 8.29985 9.8691 9.16215L9.0054 8.29835C8.90775 8.2007 8.74945 8.2007 8.6518 8.29835L8.2983 8.6518C8.20065 8.74945 8.20065 8.9077 8.2983 9.00535L9.162 9.86915C8.29975 10.5752 7.1988 11 6 11Z" fill="#D1D5DB"/></svg><a class="bd-toc-link main-link">About Kill Bill</a></div><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg>  </div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="/latest/demo.html">Demo</a></li><li><a class="nav-link" href="/latest/features.html">Features List</a></li><li><a class="nav-link" href="/latest/faq.html">Technical FAQs</a></li><li><a class="nav-link" href="/latest/Kill-Bill-Glossary.html">Glossary</a></li></ul></li><li><div class="icon-title"><div class="left-part"><svg width="13" height="14" viewBox="0 0 13 14" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12.3021 4.08526L9.66105 6.72632C10.0032 7.09579 10.2221 7.58842 10.2221 8.12211C10.2221 9.24421 9.30526 10.1611 8.18316 10.1611H5.37789C4.25579 10.1611 3.33895 9.24421 3.33895 8.12211V5.33053C3.33895 4.20842 4.25579 3.29158 5.37789 3.29158C5.92526 3.29158 6.40421 3.51053 6.77368 3.85263L9.42842 1.19789C8.53895 0.746316 7.55368 0.5 6.5 0.5C2.91474 0.5 0 3.41474 0 7C0 10.5853 2.91474 13.5 6.5 13.5C8.29263 13.5 9.92105 12.7747 11.0979 11.5979C12.2747 10.4211 13 8.79263 13 7C13 5.94632 12.7537 4.96105 12.3021 4.08526Z" fill="#D1D5DB"/><path d="M6.04841 5.33057C6.04841 4.96109 5.74736 4.64635 5.3642 4.64635C4.98105 4.64635 4.67999 4.94741 4.67999 5.33057V8.13583C4.67999 8.5053 4.98105 8.82004 5.3642 8.82004H8.16947C8.53894 8.82004 8.85368 8.51899 8.85368 8.13583C8.85368 7.75267 8.55262 7.45162 8.16947 7.45162H7.00631L12.1242 2.34741C12.3842 2.08741 12.3842 1.64951 12.1242 1.38951C11.8505 1.11583 11.4263 1.11583 11.1526 1.38951L6.04841 6.49372V5.33057Z" fill="#D1D5DB"/></svg><a class="bd-toc-link main-link">Internal</a></div><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg> </div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="/latest/internal_design.html">Internal Design</a></li><li><a class="nav-link" href="/latest/entitlement_subsystem.html">Entitlement Subsystem</a></li><li><a class="nav-link" href="/latest/invoice_subsystem.html">Invoice Subsystem</a></li><li><a class="nav-link" href="/latest/development.html">Development Environment</a></li></ul></li><li><div class="icon-title"><div class="left-part"><svg width="13" height="14" viewBox="0 0 13 14" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12.9462 5.38696C12.822 4.98052 12.5006 4.71215 12.0846 4.66832L9.06857 4.3811C8.86395 4.36202 8.69953 4.23643 8.6171 4.03592L7.41897 1.12839C7.2541 0.740566 6.902 0.5 6.50067 0.5C6.09098 0.5 5.73843 0.742216 5.58124 1.13099L4.38401 4.03639C4.3018 4.23667 4.13716 4.36225 3.93209 4.38134L0.907742 4.66879C0.502118 4.71238 0.181638 4.9791 0.0486129 5.38719C-0.0740231 5.78822 0.0391272 6.21374 0.345604 6.49908L2.62419 8.58218C2.7789 8.72449 2.84146 8.92571 2.79629 9.13376L2.12417 12.2189C2.03292 12.6346 2.18176 13.0483 2.51308 13.2985C2.83559 13.5424 3.27283 13.5624 3.61409 13.3506L6.22265 11.7324C6.39836 11.6195 6.59914 11.6176 6.78117 11.7345L9.38657 13.3504C9.54398 13.4482 9.7215 13.5 9.90015 13.5C10.1109 13.5 10.3125 13.4298 10.4813 13.2988C10.8126 13.0483 10.9616 12.6346 10.8706 12.2199L10.2048 9.13376C10.1594 8.92571 10.2222 8.72473 10.3765 8.58265L12.6541 6.49342C12.9656 6.21233 13.0769 5.78704 12.9462 5.38696Z" fill="#D1D5DB"/></svg><a class="bd-toc-link main-link">References</a></div><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg>  </div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="https://github.com/killbill/killbill-docs/tree/v3/swagger" onclick="getOutboundLink('https://github.com/killbill/killbill-docs/tree/v3/swagger'); return false;">Swagger&nbsp;API Schema</a></li><li><a class="nav-link" href="/latest/catalog.xsd">Catalog XSD Reference</a></li><li><a class="nav-link" href="/latest/overdue.xsd">Overdue XSD Reference</a></li></ul></li></ul></nav><script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script><script>
  let $ = jQuery;
  $('.icon-title').on('click', function() {
    $(this).next().toggle();
    $(this).find('.chevron').toggleClass('rotated');
  })

  let pageURL = $(location).attr("href");
  $('.nav-link').each(function() {
    if (pageURL.includes($(this).attr('href'))) {
      $(this).parent().addClass('list-item-active');
      $(this).parent().parent().addClass('active-list');
      $(this).parent().parent().prev().addClass('bd-link-active-wrap');
    }
  });
</script><a class="doclink" href="mailto:support@killbill.io">Report a doc problem     </a></aside></div><div class="col-12 col-md-9 col-xl-8"><article class="content-wrapper"><div class="banner"><div class="bg-image"><svg class="absolute-figure circle1" width="41" height="38" viewBox="0 0 41 38" fill="none" xmlns="http://www.w3.org/2000/svg">
  <ellipse cx="12.5" cy="10.5" rx="28.5" ry="27.5" fill="white" fill-opacity="0.2"/>
</svg>
<svg class="absolute-figure circle2" width="20" height="19" viewBox="0 0 20 19" fill="none" xmlns="http://www.w3.org/2000/svg">
  <ellipse cx="10" cy="9.5" rx="10" ry="9.5" fill="white" fill-opacity="0.2"/>
</svg>
<svg class="absolute-figure circle3" width="97" height="97" viewBox="0 0 97 97" fill="none" xmlns="http://www.w3.org/2000/svg">
  <circle cx="48.5" cy="48.5" r="48.5" fill="white" fill-opacity="0.4"/>
</svg>
<svg class="absolute-figure circle4" width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
  <circle cx="7" cy="7" r="7" fill="white" fill-opacity="0.2"/>
</svg>
<svg class="absolute-figure circle5" width="65" height="23" viewBox="0 0 65 23" fill="none" xmlns="http://www.w3.org/2000/svg">
  <circle cx="32.5" cy="-9.5" r="32.5" fill="white" fill-opacity="0.2"/>
</svg>
<svg class="absolute-figure circle6" width="48" height="31" viewBox="0 0 48 31" fill="none" xmlns="http://www.w3.org/2000/svg">
  <circle cx="24" cy="24" r="24" fill="white" fill-opacity="0.2"/>
</svg>
<svg class="absolute-figure circle7" width="20" height="19" viewBox="0 0 20 19" fill="none" xmlns="http://www.w3.org/2000/svg">
  <ellipse cx="10" cy="9.5" rx="10" ry="9.5" fill="white" fill-opacity="0.2"/>
</svg>
<svg class="absolute-figure circle8" width="20" height="10" viewBox="0 0 20 10" fill="none" xmlns="http://www.w3.org/2000/svg">
  <ellipse cx="10" cy="9.5" rx="10" ry="9.5" fill="white" fill-opacity="0.2"/>
</svg>
<svg class="absolute-figure circle9" width="49" height="48" viewBox="0 0 49 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <circle cx="48.5" cy="48.5" r="48.5" fill="white" fill-opacity="0.2"/>
</svg>
<svg class="absolute-figure abstract-figure" width="703" height="174" viewBox="0 0 703 174" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M25.5 246C-96 87.7673 245.949 67.3215 475.548 64.1799C705.146 61.0384 565.01 -188.501 629.653 -188.741C694.297 -188.982 766.062 221.014 766.062 221.014L297.072 460.733C297.072 460.733 147 404.233 25.5 246Z" fill="white" fill-opacity="0.2"/>
</svg></div><h1>Overdue System</h1></div><div id="content"><div id="preamble"><div class="sectionbody"><div class="paragraph" id="intro"><p>In this tutorial, we look a little bit deeper into Kill Bill&#8217;s payment retry system and overdue system. The main <a href="https://docs.killbill.io/latest/userguide_subscription.html"><em>Subscription User Guide</em></a> already explains some basics about these systems. This tutorial will show you how they work in practice.</p></div></div></div>
<div class="sect1"><h2 id="_prerequisites">Prerequisites</h2><div class="sectionbody"><div class="ulist"><ul><li><p>Ensure that you have configured Kill Bill, Kaui and the database as explained in the <a href="http://docs.killbill.io/latest/getting_started.html"><em>Getting Started</em></a> document.</p></li><li><p>Ensure that you have set up a tenant configured with API key <code>bob</code> and API secret <code>lazar</code>.</p></li><li><p>Ensure that the <code>org.killbill.server.test.mode=true</code> property is set as explained in the <a href="https://docs.killbill.io/latest/userguide_configuration.html"><em>Configuration Guide</em></a>. This property allows moving the clock through time.</p></li><li><p>Ensure that you have gone through the <a href="https://docs.killbill.io/latest/userguide_subscription.html"><em>Subscription User Guide</em></a> and are familiar with catalogs, invoices, payments and other concepts.</p></li><li><p>Ensure that you have <a href="https://curl.haxx.se/"><em>cURL</em></a> installed. If you are on Windows, we recommend that you use <a href="https://git-scm.com/download/win"><em>Git Bash</em></a> to run the <code>cURL</code> commands.</p></li></ul></div></div></div>
<div class="sect1"><h2 id="_overdue_and_payment_retry_system_overview">Overdue and Payment Retry System Overview</h2><div class="sectionbody"><div class="paragraph"><p>Before we dive into the details, let us understand some high-level concepts.</p></div>
<div class="paragraph"><p>Kill Bill has two distinct built-in mechanisms. These are the <strong>Payment Retry System</strong> and the <strong>Overdue System</strong>. Though separate, these two systems work in close conjunction with each other.</p></div>
<div class="paragraph"><p>The <strong>Payment Retry System</strong> is a system that retries failed payments as per a defined schedule. The schedule can be defined via a property in the Kill Bill configuration file or can be uploaded on a per-tenant basis.</p></div>
<div class="paragraph"><p>The <strong>Overdue System</strong> defines the flow that the system must follow when an account is overdue (that is, has an unpaid balance). It can be configured via an XML file. The XML file can be specified via a property in the Kill Bill configuration file or can be uploaded on a per-tenant basis. The XML file defines the various <em>states</em> that the account must go through, the <em>change in the user&#8217;s entitlements</em> when the account is transitioned from one state to the other and the <em>period</em> after which the state is re-evaluated.</p></div>
<div class="paragraph"><p>It is important to understand that the <strong>Payment Retry System</strong> and the <strong>Overdue System</strong> are <strong>independent</strong> of each other. So, the <strong>payment retry system</strong> attempts payments as per its retry schedule while the <strong>overdue system</strong> moves the account from one state to the other as per its configuration.</p></div>
<div class="paragraph"><p>Having said that, most business cases would require to retry payments several times before blocking the user&#8217;s access and thus would require using both systems in conjunction with one another.</p></div>
<div class="paragraph"><p>Although the payment retry system and overdue systems need to be configured independently of each other, it makes sense to <strong>align payment retries with overdue states</strong>. This allows retrying the payment on the boundary of each overdue state and thus prevents transitioning from one state to the next if the payment gets retried successfully. Further, to ensure that the payment is always retried before the overdue system, it makes sense to configure a payment retry 1 day before each overdue state.</p></div></div></div>
<div class="sect1"><h2 id="_scenario">Scenario</h2><div class="sectionbody"><div class="paragraph"><p>Let us now define a test scenario and understand how to configure the payment retry system and overdue system.</p></div>
<div class="paragraph"><p>Let&#8217;s assume you want to build a website where your customers can subscribe to movies (similar to Netflix). For simplicity&#8217;s sake, we will assume you only provide one $10/month plan for unlimited streaming. The plan will contain a 10 days trial period during which customers have unlimited access. After the trial period, the customer should be invoiced with $10. We would also want to take some actions if the user fails to pay:</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>The system should be configured to retry failed payments 4 times: the first payment retry should happen 1 day after the payment failure, the next attempt should happen 8 days after previous attempt, the third attempt should happen 4 days after the previous attempt and the last one should happen 7 days after the previous attempt</p></li><li><p>The system should notify the user when an invoice has not been paid after 10 days (during which time the system already automatically retried 2 times)</p></li><li><p>The system should block the entitlements associated with the account after 14 days</p></li><li><p>The system should automatically cancel the subscriptions after 21 days</p></li></ol></div>
<div class="paragraph"><p>Additionally, we want to prevent users from changing plans (e.g. upgrade) until they clear their balance.</p></div>
<div class="paragraph"><p>So, the scenario specified above requires configuring 3 overdue states. The account should be moved to the first overdue state 10 days after an unpaid invoice, it should move to the second overdue state 14 days after the unpaid invoice and it should be moved to the final overdue state 21 days after the unpaid invoice.</p></div>
<div class="paragraph"><p>Further, the scenario above also specifies the payment retries in such a way that they align with the overdue states. So, it requires the second payment attempt to be made after 9 days (just before the first overdue state), the third payment attempt after 13 days (before the second overdue state) and the final payment attempt after 20 days (before the last overdue state). Thus, we are configuring the system to retry payments 1 day before each overdue state.</p></div>
<div class="paragraph"><p>Let us now understand how to to configure both the <strong>Payment Retry System</strong> and the <strong>Overdue system</strong> in order to implement this scenario.</p></div></div></div>
<div class="sect1"><h2 id="_configuration_of_the_system">Configuration of the System</h2><div class="sectionbody"><div class="sect2"><h3 id="_catalog_configuration">Catalog Configuration</h3><div class="paragraph"><p>First of all, you will need to create a catalog. Your catalog will contain a plan entry that specifies two phases, one for the trial period of 10 days and one for the recurring monthly charge of $10:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="xml"><span></span><span class="tok-cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tok-nt">&lt;catalog</span> <span class="tok-na">xmlns:xsi=</span><span class="tok-s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="tok-na">xsi:noNamespaceSchemaLocation=</span><span class="tok-s">&quot;CatalogSchema.xsd &quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;effectiveDate&gt;</span>2013-02-08T00:00:00+00:00<span class="tok-nt">&lt;/effectiveDate&gt;</span>
    <span class="tok-nt">&lt;catalogName&gt;</span>Movies<span class="tok-nt">&lt;/catalogName&gt;</span>
    <span class="tok-nt">&lt;recurringBillingMode&gt;</span>IN_ADVANCE<span class="tok-nt">&lt;/recurringBillingMode&gt;</span>
    <span class="tok-nt">&lt;currencies&gt;</span>
        <span class="tok-nt">&lt;currency&gt;</span>USD<span class="tok-nt">&lt;/currency&gt;</span>
    <span class="tok-nt">&lt;/currencies&gt;</span>
    <span class="tok-nt">&lt;products&gt;</span>
        <span class="tok-nt">&lt;product</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Movies&quot;</span><span class="tok-nt">&gt;</span>
            <span class="tok-nt">&lt;category&gt;</span>BASE<span class="tok-nt">&lt;/category&gt;</span>
        <span class="tok-nt">&lt;/product&gt;</span>
    <span class="tok-nt">&lt;/products&gt;</span>
    <span class="tok-nt">&lt;rules&gt;</span>
        <span class="tok-nt">&lt;changePolicy&gt;</span>
            <span class="tok-nt">&lt;changePolicyCase&gt;</span>
                <span class="tok-nt">&lt;policy&gt;</span>IMMEDIATE<span class="tok-nt">&lt;/policy&gt;</span>
            <span class="tok-nt">&lt;/changePolicyCase&gt;</span>
        <span class="tok-nt">&lt;/changePolicy&gt;</span>
        <span class="tok-nt">&lt;cancelPolicy&gt;</span>
            <span class="tok-nt">&lt;cancelPolicyCase&gt;</span>
                <span class="tok-nt">&lt;policy&gt;</span>IMMEDIATE<span class="tok-nt">&lt;/policy&gt;</span>
            <span class="tok-nt">&lt;/cancelPolicyCase&gt;</span>
        <span class="tok-nt">&lt;/cancelPolicy&gt;</span>
    <span class="tok-nt">&lt;/rules&gt;</span>
    <span class="tok-nt">&lt;plans&gt;</span>
      <span class="tok-nt">&lt;plan</span> <span class="tok-na">name=</span><span class="tok-s">&quot;movies-monthly&quot;</span><span class="tok-nt">&gt;</span>
          <span class="tok-nt">&lt;product&gt;</span>Movies<span class="tok-nt">&lt;/product&gt;</span>
          <span class="tok-nt">&lt;initialPhases&gt;</span>
             <span class="tok-nt">&lt;phase</span> <span class="tok-na">type=</span><span class="tok-s">&quot;TRIAL&quot;</span><span class="tok-nt">&gt;</span>
                 <span class="tok-nt">&lt;duration&gt;</span>
                     <span class="tok-nt">&lt;unit&gt;</span>DAYS<span class="tok-nt">&lt;/unit&gt;</span>
                     <span class="tok-nt">&lt;number&gt;</span>10<span class="tok-nt">&lt;/number&gt;</span>
                 <span class="tok-nt">&lt;/duration&gt;</span>
                 <span class="tok-nt">&lt;fixed&gt;</span>
                   <span class="tok-nt">&lt;fixedPrice&gt;</span>
                   <span class="tok-nt">&lt;/fixedPrice&gt;</span>
                 <span class="tok-nt">&lt;/fixed&gt;</span>
             <span class="tok-nt">&lt;/phase&gt;</span>
          <span class="tok-nt">&lt;/initialPhases&gt;</span>
          <span class="tok-nt">&lt;finalPhase</span> <span class="tok-na">type=</span><span class="tok-s">&quot;EVERGREEN&quot;</span><span class="tok-nt">&gt;</span>
              <span class="tok-nt">&lt;duration&gt;</span>
                  <span class="tok-nt">&lt;unit&gt;</span>UNLIMITED<span class="tok-nt">&lt;/unit&gt;</span>
              <span class="tok-nt">&lt;/duration&gt;</span>
              <span class="tok-nt">&lt;recurring&gt;</span>
                  <span class="tok-nt">&lt;billingPeriod&gt;</span>MONTHLY<span class="tok-nt">&lt;/billingPeriod&gt;</span>
                  <span class="tok-nt">&lt;recurringPrice&gt;</span>
                      <span class="tok-nt">&lt;price&gt;</span>
                          <span class="tok-nt">&lt;currency&gt;</span>USD<span class="tok-nt">&lt;/currency&gt;</span>
                          <span class="tok-nt">&lt;value&gt;</span>10.00<span class="tok-nt">&lt;/value&gt;</span>
                      <span class="tok-nt">&lt;/price&gt;</span>
                  <span class="tok-nt">&lt;/recurringPrice&gt;</span>
              <span class="tok-nt">&lt;/recurring&gt;</span>
          <span class="tok-nt">&lt;/finalPhase&gt;</span>
      <span class="tok-nt">&lt;/plan&gt;</span>
    <span class="tok-nt">&lt;/plans&gt;</span>
    <span class="tok-nt">&lt;priceLists&gt;</span>
        <span class="tok-nt">&lt;defaultPriceList</span> <span class="tok-na">name=</span><span class="tok-s">&quot;DEFAULT&quot;</span><span class="tok-nt">&gt;</span>
            <span class="tok-nt">&lt;plans&gt;</span>
                <span class="tok-nt">&lt;plan&gt;</span>movies-monthly<span class="tok-nt">&lt;/plan&gt;</span>
            <span class="tok-nt">&lt;/plans&gt;</span>
        <span class="tok-nt">&lt;/defaultPriceList&gt;</span>
    <span class="tok-nt">&lt;/priceLists&gt;</span>
<span class="tok-nt">&lt;/catalog&gt;</span></code></pre></div></div>
<div class="paragraph"><p>You can upload the catalog by hitting the following endpoint:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="bash"><span></span>curl -v <span class="tok-se">\</span>
-u <span class="tok-s1">&#39;admin:password&#39;</span> <span class="tok-se">\</span>
-H <span class="tok-s2">&quot;X-Killbill-ApiKey: bob&quot;</span> <span class="tok-se">\</span>
-H <span class="tok-s2">&quot;X-Killbill-ApiSecret: lazar&quot;</span> <span class="tok-se">\</span>
-H <span class="tok-s2">&quot;Content-Type: text/xml&quot;</span> <span class="tok-se">\</span>
-H <span class="tok-s2">&quot;X-Killbill-CreatedBy: stephane&quot;</span> <span class="tok-se">\</span>
-X POST <span class="tok-se">\</span>
-d @/VALID_PATH/catalog.xml <span class="tok-se">\</span>
<span class="tok-s2">&quot;http://127.0.0.1:8080/1.0/kb/catalog/xml&quot;</span></code></pre></div></div>
<div class="paragraph"><p>In order to understand more about catalogs, you can refer to the <a href="https://docs.killbill.io/latest/userguide_subscription.html#components-catalog"><em>Subscription Billing</em></a> document.</p></div></div>
<div class="sect2"><h3 id="_overdue_configuration">Overdue Configuration</h3><div class="paragraph"><p>Next, you need to define the overdue configuration XML file.</p></div>
<div class="sect3"><h4 id="_creating_overdue_xml_file">Creating Overdue.xml File</h4><div class="paragraph"><p>Based on the scenario defined above, the overdue configuration will define the three states the account will go through:</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>The account will enter the <code>WARNING</code> state 10 days after the first unpaid invoice (Trial period will last for 10 days, after which a $10 invoice will be generated. 10 days after this (20 days after the subscription creation), the account needs to enter the <code>WARNING</code> state)</p></li><li><p>4 days later, the account will move to the <code>BLOCKED</code> state</p></li><li><p>7 days later, the account will move to the <code>CANCELLATION</code> state.</p></li></ol></div>
<div class="paragraph"><p>You can create an XML file corresponding to this overdue configuration as follows:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="xml"><span></span><span class="tok-nt">&lt;overdueConfig&gt;</span>
   <span class="tok-nt">&lt;accountOverdueStates&gt;</span>
       <span class="tok-nt">&lt;initialReevaluationInterval&gt;</span>
           <span class="tok-nt">&lt;unit&gt;</span>DAYS<span class="tok-nt">&lt;/unit&gt;&lt;number&gt;</span>10<span class="tok-nt">&lt;/number&gt;</span>
       <span class="tok-nt">&lt;/initialReevaluationInterval&gt;</span>
       <span class="tok-nt">&lt;state</span> <span class="tok-na">name=</span><span class="tok-s">&quot;CANCELLATION&quot;</span><span class="tok-nt">&gt;</span>
           <span class="tok-nt">&lt;condition&gt;</span>
               <span class="tok-nt">&lt;timeSinceEarliestUnpaidInvoiceEqualsOrExceeds&gt;</span>
                   <span class="tok-nt">&lt;unit&gt;</span>DAYS<span class="tok-nt">&lt;/unit&gt;&lt;number&gt;</span>21<span class="tok-nt">&lt;/number&gt;</span>
               <span class="tok-nt">&lt;/timeSinceEarliestUnpaidInvoiceEqualsOrExceeds&gt;</span>
           <span class="tok-nt">&lt;/condition&gt;</span>
           <span class="tok-nt">&lt;externalMessage&gt;</span>Reached CANCELATION<span class="tok-nt">&lt;/externalMessage&gt;</span>
           <span class="tok-nt">&lt;subscriptionCancellationPolicy&gt;</span>END_OF_TERM<span class="tok-nt">&lt;/subscriptionCancellationPolicy&gt;</span>
       <span class="tok-nt">&lt;/state&gt;</span>
       <span class="tok-nt">&lt;state</span> <span class="tok-na">name=</span><span class="tok-s">&quot;BLOCKED&quot;</span><span class="tok-nt">&gt;</span>
           <span class="tok-nt">&lt;condition&gt;</span>
               <span class="tok-nt">&lt;timeSinceEarliestUnpaidInvoiceEqualsOrExceeds&gt;</span>
                   <span class="tok-nt">&lt;unit&gt;</span>DAYS<span class="tok-nt">&lt;/unit&gt;&lt;number&gt;</span>14<span class="tok-nt">&lt;/number&gt;</span>
               <span class="tok-nt">&lt;/timeSinceEarliestUnpaidInvoiceEqualsOrExceeds&gt;</span>
           <span class="tok-nt">&lt;/condition&gt;</span>
           <span class="tok-nt">&lt;externalMessage&gt;</span>Reached BLOCKED<span class="tok-nt">&lt;/externalMessage&gt;</span>
           <span class="tok-nt">&lt;blockChanges&gt;</span>true<span class="tok-nt">&lt;/blockChanges&gt;</span>
           <span class="tok-nt">&lt;disableEntitlementAndChangesBlocked&gt;</span>false<span class="tok-nt">&lt;/disableEntitlementAndChangesBlocked&gt;</span>
           <span class="tok-nt">&lt;autoReevaluationInterval&gt;</span>
               <span class="tok-nt">&lt;unit&gt;</span>DAYS<span class="tok-nt">&lt;/unit&gt;&lt;number&gt;</span>7<span class="tok-nt">&lt;/number&gt;</span>
           <span class="tok-nt">&lt;/autoReevaluationInterval&gt;</span>
       <span class="tok-nt">&lt;/state&gt;</span>
       <span class="tok-nt">&lt;state</span> <span class="tok-na">name=</span><span class="tok-s">&quot;WARNING&quot;</span><span class="tok-nt">&gt;</span>
           <span class="tok-nt">&lt;condition&gt;</span>
               <span class="tok-nt">&lt;timeSinceEarliestUnpaidInvoiceEqualsOrExceeds&gt;</span>
                   <span class="tok-nt">&lt;unit&gt;</span>DAYS<span class="tok-nt">&lt;/unit&gt;&lt;number&gt;</span>10<span class="tok-nt">&lt;/number&gt;</span>
               <span class="tok-nt">&lt;/timeSinceEarliestUnpaidInvoiceEqualsOrExceeds&gt;</span>
           <span class="tok-nt">&lt;/condition&gt;</span>
           <span class="tok-nt">&lt;externalMessage&gt;</span>Reached WARNING<span class="tok-nt">&lt;/externalMessage&gt;</span>
           <span class="tok-nt">&lt;blockChanges&gt;</span>true<span class="tok-nt">&lt;/blockChanges&gt;</span>
           <span class="tok-nt">&lt;disableEntitlementAndChangesBlocked&gt;</span>false<span class="tok-nt">&lt;/disableEntitlementAndChangesBlocked&gt;</span>
           <span class="tok-nt">&lt;autoReevaluationInterval&gt;</span>
               <span class="tok-nt">&lt;unit&gt;</span>DAYS<span class="tok-nt">&lt;/unit&gt;&lt;number&gt;</span>4<span class="tok-nt">&lt;/number&gt;</span>
           <span class="tok-nt">&lt;/autoReevaluationInterval&gt;</span>
       <span class="tok-nt">&lt;/state&gt;</span>
   <span class="tok-nt">&lt;/accountOverdueStates&gt;</span>
<span class="tok-nt">&lt;/overdueConfig&gt;</span></code></pre></div></div>
<div class="paragraph"><p>In more detail:</p></div>
<div class="ulist"><ul><li><p><code>initialReevaluationInterval</code> is set to 10 (if no payment is posted, the overdue state is recomputed 10 days later to match <code>timeSinceEarliestUnpaidInvoiceEqualsOrExceeds</code>)</p></li><li><p><code>WARNING</code>:</p><div class="ulist"><ul><li><p><code>timeSinceEarliestUnpaidInvoiceEqualsOrExceeds</code> is set to 10 days as specified by the scenario</p></li><li><p><code>blockChanges</code> is set to true to prevent users from changing plans</p></li><li><p><code>disableEntitlementAndChangesBlocked</code> is set to false, since we still want the user to have access to the service</p></li><li><p><code>autoReevaluationInterval</code> is set to 4 days to make sure that if there is no payment (which would trigger a re-evaluation of the overdue state), the state will be correctly recomputed and transition to <code>BLOCKED</code> 4 days later</p></li></ul></div></li><li><p><code>BLOCKED</code>:</p><div class="ulist"><ul><li><p><code>blockChanges</code> is set to true to prevent users from changing plans</p></li><li><p><code>timeSinceEarliestUnpaidInvoiceEqualsOrExceeds</code> is set to 14 days as specified by the scenario</p></li><li><p><code>disableEntitlementAndChangesBlocked</code> is also set to false. This configuration also has an impact on the billing so setting it to true would block the billing (and entitlement) from that date forward.</p></li><li><p><code>autoReevaluationInterval</code> is set to 8 days to make sure that if there is no payment (no overdue trigger), the state will be correctly recomputed and transition to <code>CANCELLATION</code> 8 days later</p></li></ul></div></li><li><p><code>CANCELLATION</code>:</p><div class="ulist"><ul><li><p><code>subscriptionCancellationPolicy</code> is set to <code>END_OF_TERM</code> to indicate that subscriptions should be cancelled in such a way that we do not generate credit for the account (no proration)</p></li></ul></div></li></ul></div></div>
<div class="sect3"><h4 id="_some_important_notes">Some Important Notes</h4><div class="olist arabic"><ol class="arabic"><li><p>The definition order of the states in the XML configuration file is important: You must have the first state at the bottom and then all the way up to the last state (as shown in our example).</p></li><li><p>The overdue state names (<code>name</code> attribute of <code>state</code> tag) should not contain spaces. In case a space is specified in the state name, an error will occur while uploading the overdue XML file.</p></li></ol></div></div>
<div class="sect3"><h4 id="_uploading_overdue_configuration">Uploading Overdue Configuration</h4><div class="paragraph"><p>The path of the overdue configuration file can be specified as a property in the <a href="https://docs.killbill.io/latest/userguide_configuration.html#global_configuration_properties">Kill Bill Configuration File</a> as follows:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="properties"><span></span><span class="tok-na">org.killbill.overdue.uri</span><span class="tok-o">=</span><span class="tok-s">file:///&lt;path&gt;/overdue.xml</span></code></pre></div></div>
<div class="paragraph"><p>Alternately, you can upload the overdue configuration on a per-tenant basis by hitting the following endpoint:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="bash"><span></span>curl -v <span class="tok-se">\</span>
-u <span class="tok-s1">&#39;admin:password&#39;</span> <span class="tok-se">\</span>
-H <span class="tok-s2">&quot;X-Killbill-ApiKey: bob&quot;</span> <span class="tok-se">\</span>
-H <span class="tok-s2">&quot;X-Killbill-ApiSecret: lazar&quot;</span> <span class="tok-se">\</span>
-H <span class="tok-s2">&quot;Content-Type: text/xml&quot;</span> <span class="tok-se">\</span>
-H <span class="tok-s2">&quot;X-Killbill-CreatedBy: stephane&quot;</span> <span class="tok-se">\</span>
-X POST <span class="tok-se">\</span>
-d @/VALID_PATH/overdue.xml <span class="tok-se">\</span>
<span class="tok-s2">&quot;http://127.0.0.1:8080/1.0/kb/overdue/xml&quot;</span></code></pre></div></div></div></div>
<div class="sect2"><h3 id="_payment_retries_system_configuration">Payment Retries System Configuration</h3><div class="paragraph"><p>The scenario defined above also requires the payments to be attempted 4 times with a gap of 1,8, 4 and 7 days between attempts. Thus, the payment retry system needs to be configured as per this schedule.</p></div>
<div class="paragraph"><p>The payment retry schedule can be configured as a property in the <a href="https://docs.killbill.io/latest/userguide_configuration.html#global_configuration_properties">Kill Bill Configuration File</a> as follows:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="properties"><span></span><span class="tok-na">org.killbill.payment.retry.days</span><span class="tok-o">=</span><span class="tok-s">1,8,4,7</span></code></pre></div></div>
<div class="paragraph"><p>Alternately, you can upload the payment retry schedule on a <a href="https://docs.killbill.io/latest/userguide_configuration.html#_per_tenant_properties">per-tenant</a> basis by hitting the following endpoint:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="bash"><span></span>curl -v <span class="tok-se">\</span>
-u admin:password <span class="tok-se">\</span>
-H <span class="tok-s2">&quot;X-Killbill-ApiKey: bob&quot;</span> <span class="tok-se">\</span>
-H <span class="tok-s1">&#39;X-Killbill-ApiSecret: lazar&#39;</span> <span class="tok-se">\</span>
-H <span class="tok-s2">&quot;Content-Type: text/plain&quot;</span> <span class="tok-se">\</span>
-H <span class="tok-s1">&#39;X-Killbill-CreatedBy: stephane&#39;</span> <span class="tok-se">\</span>
-X POST <span class="tok-se">\</span>
--data-binary <span class="tok-s1">&#39;{&quot;org.killbill.payment.retry.days&quot;:&quot;1,8,4,7&quot;}&#39;</span> <span class="tok-se">\</span>
<span class="tok-s2">&quot;http://127.0.0.1:8080/1.0/kb/tenants/uploadPerTenantConfig&quot;</span></code></pre></div></div>
<div class="paragraph"><p>Additionally, if you need more granularity in how you want to retry payments, you can implement your own logic in a <a href="https://docs.killbill.io/latest/payment_control_plugin.html">Payment Control Plugin</a> (which goes beyond the scope of this tutorial).</p></div></div></div></div>
<div class="sect1"><h2 id="customers">Some Customer Flows</h2><div class="sectionbody"><div class="paragraph"><p>Let us now take a look at some typical customer flows and understand how the payment retry system and overdue system will function.</p></div>
<div class="sect2"><h3 id="_flow_1_good_customer_no_issue_with_payment">Flow 1 - Good Customer, No issue with payment</h3><div class="paragraph"><p>Let us first understand what happens when there is no issue with the payment:</p></div>
<div class="paragraph"><p><span class="image"><img src="https://github.com/killbill/killbill-docs/raw/v3/userguide/assets/img/overdue/overdue-flow1.png" alt="overdue flow1"></span></p></div>
<div class="paragraph"><p>Immediately after the customer subscribes, a $0 invoice is created to indicate the customer is in TRIAL. 10 days later, the customer moves out of TRIAL and the system generates a $10 invoice for the month. At this point, the system attempts to make a payment which is successful.</p></div>
<div class="paragraph"><p>So, in this case, the payment retry system <strong>DOES NOT</strong> kick-in.</p></div></div>
<div class="sect2"><h3 id="_flow_2_good_customer_fixes_payment_issue_during_retry_flow">Flow 2 - Good Customer, fixes payment issue during retry flow</h3><div class="paragraph"><p>Next, suppose the customer&#8217;s credit card does not have enough funds to cover the payment initially but the customer fixes this issue later on:</p></div>
<div class="paragraph"><p><span class="image"><img src="https://github.com/killbill/killbill-docs/raw/v3/userguide/assets/img/overdue/overdue-flow2.png" alt="overdue flow2"></span></p></div>
<div class="paragraph"><p>As before, the system attempts a payment after the trial period. Since this payment fails, the payment retry system is activated. It retries a payment <strong>1</strong> day later (on <code>2021-08-07</code>). The customer then fixes his/her credit card issue on <code>2021-08-09</code>. The payment retry system which is scheduled to run again <strong>8</strong> days later runs on <code>2021-08-15</code>. At this point, the payment is successful, so no more payments are attempted.</p></div></div>
<div class="sect2"><h3 id="_flow_3_good_customer_fixes_payment_issue_during_overdue_flow">Flow 3 - Good Customer, fixes payment issue during overdue flow</h3><div class="paragraph"><p>In the next scenario, let us see what happens when the customer fixes his/her credit card issue after the overdue flow has kicked in:</p></div>
<div class="paragraph"><p><span class="image"><img src="https://github.com/killbill/killbill-docs/raw/v3/userguide/assets/img/overdue/overdue-flow3.png" alt="overdue flow3"></span></p></div>
<div class="paragraph"><p>As before, the system attempts a payment after the trial period which fails. The payment retry system then attempts the payment after <strong>1</strong> day(on <code>2021-08-07</code>) and again after <strong>8</strong> days(on <code>2021-08-15</code>). On <code>2021-08-16</code>, 10 days have elapsed since the first unpaid invoice. So, the overdue system is activated which moves the account to the <code>WARNING</code> state. The customer then fixes his/her credit card issue on <code>2021-08-18</code>.The payment retry system (which has already made <strong>2</strong> payment attempts), is scheduled to make the third payment attempt <strong>4</strong> days after the previous payment attempt. The previous payment attempt was on <code>2021-08-15</code> so the payment retry system attempts a payment on <code>2021-08-19</code>. Since the payment issue is now fixed, the payment is successful. So, the account is moved back to the <code>CLEAR</code> state.</p></div></div>
<div class="sect2"><h3 id="_flow_4_bad_customer_does_not_fix_payment_issue">Flow 4 - Bad Customer, does not fix payment issue</h3><div class="paragraph"><p>Let us now consider what happens when the customer is a bad customer and does not fix the payment issue:</p></div>
<div class="paragraph"><p><span class="image"><img src="https://github.com/killbill/killbill-docs/raw/v3/userguide/assets/img/overdue/overdue-flow4.png" alt="overdue flow4"></span></p></div>
<div class="paragraph"><p>As in the case of the previous flow, the payment retry system retries the payment two times on <code>2021-08-07</code> and on <code>2021-08-15</code> after which the Overdue flow then kicks in and moves the account to the <code>WARNING</code> state on <code>2021-08-16</code>. The payment retry system makes the the third payment attempt on <code>2021-08-19</code> which fails. The Overdue system (which is configured to run <strong>4</strong> days after the previous run) runs on <code>2021-08-20</code> and moves the account to the <code>BLOCKED</code> state. Since the customer does not fix the payment issue, the payment fails when the payment retry system attempt it the fourth time on <code>2021-08-26</code>. The Overdue system is configured to run one more time after <strong>7</strong> day after the previous run. Since the Overdue system was previously run on <code>2021-08-20</code>, it runs on <code>2021-08-27</code> and moves the account to the <code>CANCELLATION</code> state.</p></div></div></div></div>
<div class="sect1"><h2 id="testing">Configuring the Payment Test Plugin</h2><div class="sectionbody"><div class="paragraph"><p>In order to test the system, one must be able to make payments fail. We have created a <a href="https://github.com/killbill/killbill-payment-test-plugin"><em>Payment Test Plugin</em></a> that can be configured through an api  call to make payments fail.</p></div>
<div class="paragraph"><p>The plugin can be installed using any of the methods specified in the <a href="https://docs.killbill.io/latest/plugin_installation.html#_plugin_installation"><em>Plugin Installation Instructions</em></a>.</p></div>
<div class="paragraph"><p>For example, to install the plugin via <a href="https://github.com/killbill/killbill-cloud/tree/master/kpm">kpm</a>, you need to run the following command:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="bash"><span></span>kpm install_java_plugin <span class="tok-s1">&#39;payment-test&#39;</span> --destination<span class="tok-o">=</span><span class="tok-s2">&quot;&lt;path_to_install_plugin&gt;&quot;</span></code></pre></div></div></div></div>
<div class="sect1"><h2 id="_testing_the_system">Testing the System</h2><div class="sectionbody"><div class="paragraph"><p>Now that we have everything ready, we can test the system. We will be simulating the following flow:</p></div>
<div class="paragraph"><p><span class="image"><img src="https://github.com/killbill/killbill-docs/raw/v3/userguide/assets/img/overdue/overdue-test-flow.png" alt="overdue test flow"></span></p></div>
<div class="paragraph"><p>So, we will be doing the following:</p></div>
<div class="ulist"><ul><li><p>Create an account</p></li><li><p>Add default payment matching our test payment plugin</p></li><li><p>Create a subscription</p></li><li><p>Move the clock after the trial and observe first successful payment</p></li><li><p>Configure payment plugin to fail payments</p></li><li><p>Move the clock a month later and observe first failed payment</p></li><li><p>Move clock +1 day and observe first payment retry</p></li><li><p>Move clock +8 day and observe second payment retry</p></li><li><p>Move clock +1 day and first overdue state <code>WARNING</code></p></li><li><p>Move clock +3 day and observe third payment retry</p></li><li><p>Move clock +1 day and observe second overdue state <code>BLOCKED</code></p></li><li><p>Move clock +1 day and configure payment plugin to succeed</p></li><li><p>Move clock +5 day (7 days from last payment attempt) and observe fourth payment retry which is successful</p></li></ul></div>
<div class="paragraph"><p><strong>Notes:</strong></p></div>
<div class="olist arabic"><ol class="arabic"><li><p>For simplicity, we are using dates (e.g <code>2021-01-10</code>) when manipulating the Kill Bill clock instead of fully qualified datetimes (<code>2021-01-10T01:43:23.000Z</code>). Passing such a date will end up moving the Kill Bill clock to a given point in time and that point in time may end up before the exact time of the event we are trying to trigger. In such a case, retry moving the clock by one day and that should trigger it. An alternative is to specify the exact datetime when moving the clock. This would require retrieving the account object and obtaining the <code>reference_time</code> field from it to know the exact date time.</p></li><li><p>As you proceed with the steps below, you can verify each step by viewing the account in Kaui. The main account screen includes an <code>OVERDUE STATUS</code> field in the <code>Billing Info</code> section. The <code>payment</code> and <code>invoices</code> tab include information about payments and invoices. The <code>Timeline</code> tab within the account screen includes information about payment retries.</p></li><li><p>Start Kill Bill Ensure either on <a href="https://docs.killbill.io/latest/getting_started.html#_aws_one_click"><em>AWS</em></a>, <a href="https://docs.killbill.io/latest/getting_started.html#_docker"><em>Docker</em></a>, <a href="https://docs.killbill.io/latest/getting_started.html#_tomcat"><em>Tomcat</em></a> or in  <a href="https://docs.killbill.io/latest/development.html#_running_the_application"><em>standalone</em></a> mode.</p></li><li><p>Set the date to <code>2021-07-26</code> (This is not mandatory, but would make the flow in sync with the diagram above):</p><div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="bash"><span></span>curl -v <span class="tok-se">\</span>
-u admin:password <span class="tok-se">\</span>
-H <span class="tok-s2">&quot;X-Killbill-ApiKey: bob&quot;</span> <span class="tok-se">\</span>
-H <span class="tok-s2">&quot;X-Killbill-ApiSecret: lazar&quot;</span> <span class="tok-se">\</span>
-H <span class="tok-s2">&quot;Content-Type: application/json&quot;</span> <span class="tok-se">\</span>
-H <span class="tok-s1">&#39;X-Killbill-CreatedBy: demo&#39;</span> <span class="tok-se">\</span>
-X POST <span class="tok-se">\</span>
<span class="tok-s2">&quot;http://127.0.0.1:8080/1.0/kb/test/clock?requestedDate=2021-07-26&quot;</span></code></pre></div></div></li><li><p>Create your account:</p><div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="bash"><span></span>curl -v <span class="tok-se">\</span>
-u admin:password <span class="tok-se">\</span>
-H <span class="tok-s2">&quot;X-Killbill-ApiKey: bob&quot;</span> <span class="tok-se">\</span>
-H <span class="tok-s2">&quot;X-Killbill-ApiSecret: lazar&quot;</span> <span class="tok-se">\</span>
-H <span class="tok-s2">&quot;Content-Type: application/json&quot;</span> <span class="tok-se">\</span>
-H <span class="tok-s2">&quot;X-Killbill-CreatedBy: demo&quot;</span> <span class="tok-se">\</span>
-X POST <span class="tok-se">\</span>
--data-binary <span class="tok-s1">&#39;{&quot;name&quot;:&quot;Arthur&quot;,&quot;email&quot;:&quot;arthur@laposte.fr&quot;,&quot;externalKey&quot;:&quot;arthur&quot;,&quot;currency&quot;:&quot;USD&quot;}&#39;</span> <span class="tok-se">\</span>
<span class="tok-s2">&quot;http://127.0.0.1:8080/1.0/kb/accounts&quot;</span></code></pre></div></div></li><li><p>Add the payment method (assuming <code>60035793-cbe5-472a-8bd8-3c67cc3beaf4</code> is the accountId):</p><div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="bash"><span></span>curl -v <span class="tok-se">\</span>
-u admin:password <span class="tok-se">\</span>
-H <span class="tok-s2">&quot;X-Killbill-ApiKey: bob&quot;</span> <span class="tok-se">\</span>
-H <span class="tok-s2">&quot;X-Killbill-ApiSecret: lazar&quot;</span> <span class="tok-se">\</span>
-H <span class="tok-s2">&quot;Content-Type: application/json&quot;</span> <span class="tok-se">\</span>
-H <span class="tok-s2">&quot;X-Killbill-CreatedBy: demo&quot;</span> <span class="tok-se">\</span>
-X POST <span class="tok-se">\</span>
--data-binary <span class="tok-s1">&#39;{&quot;pluginName&quot;:&quot;killbill-payment-test&quot;,&quot;pluginInfo&quot;:{}}&#39;</span> <span class="tok-se">\</span>
<span class="tok-s2">&quot;http://127.0.0.1:8080/1.0/kb/accounts/60035793-cbe5-472a-8bd8-3c67cc3beaf4/paymentMethods?isDefault=true&quot;</span></code></pre></div></div></li><li><p>Create a subscription and verify that a $0 invoice is generated:</p><div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="bash"><span></span>curl -v <span class="tok-se">\</span>
-u admin:password <span class="tok-se">\</span>
-H <span class="tok-s2">&quot;X-Killbill-ApiKey: bob&quot;</span> <span class="tok-se">\</span>
-H <span class="tok-s2">&quot;X-Killbill-ApiSecret: lazar&quot;</span> <span class="tok-se">\</span>
-H <span class="tok-s2">&quot;Content-Type: application/json&quot;</span> <span class="tok-se">\</span>
-H <span class="tok-s2">&quot;X-Killbill-CreatedBy: demo&quot;</span> <span class="tok-se">\</span>
-X POST <span class="tok-se">\</span>
--data-binary <span class="tok-s1">&#39;{&quot;accountId&quot;:&quot;60035793-cbe5-472a-8bd8-3c67cc3beaf4&quot;,&quot;externalKey&quot;:&quot;s1_arthur&quot;,&quot;productName&quot;:&quot;Movies&quot;,&quot;productCategory&quot;:&quot;BASE&quot;,&quot;billingPeriod&quot;:&quot;MONTHLY&quot;,&quot;priceList&quot;:&quot;DEFAULT&quot;}&#39;</span> <span class="tok-se">\</span>
<span class="tok-s2">&quot;http://127.0.0.1:8080/1.0/kb/subscriptions&quot;</span></code></pre></div></div></li><li><p>Move the clock to reach end of trial (<code>2021-08-06</code>) and see first payment:</p><div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="bash"><span></span>curl -v <span class="tok-se">\</span>
-u admin:password <span class="tok-se">\</span>
-H <span class="tok-s2">&quot;X-Killbill-ApiKey: bob&quot;</span> <span class="tok-se">\</span>
-H <span class="tok-s2">&quot;X-Killbill-ApiSecret: lazar&quot;</span> <span class="tok-se">\</span>
-H <span class="tok-s2">&quot;Content-Type: application/json&quot;</span> <span class="tok-se">\</span>
-H <span class="tok-s1">&#39;X-Killbill-CreatedBy: demo&#39;</span> <span class="tok-se">\</span>
-X POST <span class="tok-se">\</span>
<span class="tok-s2">&quot;http://127.0.0.1:8080/1.0/kb/test/clock?requestedDate=2021-08-06&quot;</span></code></pre></div></div></li><li><p>Configure the payment plugin to fail subsequent payments (You can refer to the  <a href="https://github.com/killbill/killbill-payment-test-plugin#global-state-configuration"><em>Payment Test Plugin Global State Configuration</em></a> to understand this better).</p><div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="bash"><span></span>curl -v <span class="tok-se">\</span>
-u<span class="tok-s1">&#39;admin:password&#39;</span> <span class="tok-se">\</span>
-H <span class="tok-s2">&quot;X-Killbill-ApiKey: bob&quot;</span> <span class="tok-se">\</span>
-H <span class="tok-s2">&quot;X-Killbill-ApiSecret: lazar&quot;</span> <span class="tok-se">\</span>
-H <span class="tok-s2">&quot;Content-Type: application/json&quot;</span> <span class="tok-se">\</span>
-H <span class="tok-s1">&#39;X-Killbill-CreatedBy: demo&#39;</span> <span class="tok-se">\</span>
-X POST <span class="tok-se">\</span>
--data-binary <span class="tok-s1">&#39;{&quot;CONFIGURE_ACTION&quot;:&quot;ACTION_RETURN_PLUGIN_STATUS_ERROR&quot;, &quot;METHODS&quot;:&quot;purchasePayment&quot;}&#39;</span> <span class="tok-se">\</span>
 -v <span class="tok-s1">&#39;http://127.0.0.1:8080/plugins/killbill-payment-test/configure&#39;</span></code></pre></div></div></li><li><p>Move the clock to the next month (<code>2021-09-06</code>) and observe first failed payment:</p><div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="bash"><span></span>curl -v <span class="tok-se">\</span>
-u admin:password <span class="tok-se">\</span>
-H <span class="tok-s2">&quot;X-Killbill-ApiKey: bob&quot;</span> <span class="tok-se">\</span>
-H <span class="tok-s2">&quot;X-Killbill-ApiSecret: lazar&quot;</span> <span class="tok-se">\</span>
-H <span class="tok-s2">&quot;Content-Type: application/json&quot;</span> <span class="tok-se">\</span>
-H <span class="tok-s1">&#39;X-Killbill-CreatedBy: demo&#39;</span> <span class="tok-se">\</span>
-X POST <span class="tok-se">\</span>
<span class="tok-s2">&quot;http://127.0.0.1:8080/1.0/kb/test/clock?requestedDate=2021-09-06&quot;</span></code></pre></div></div></li><li><p>Move clock +1 day (<code>2021-09-07</code>) and observe first payment retry:</p><div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="bash"><span></span>curl -v <span class="tok-se">\</span>
-u admin:password <span class="tok-se">\</span>
-H <span class="tok-s2">&quot;X-Killbill-ApiKey: bob&quot;</span> <span class="tok-se">\</span>
-H <span class="tok-s2">&quot;X-Killbill-ApiSecret: lazar&quot;</span> <span class="tok-se">\</span>
-H <span class="tok-s2">&quot;Content-Type: application/json&quot;</span> <span class="tok-se">\</span>
-H <span class="tok-s1">&#39;X-Killbill-CreatedBy: demo&#39;</span> <span class="tok-se">\</span>
-X POST <span class="tok-se">\</span>
<span class="tok-s2">&quot;http://127.0.0.1:8080/1.0/kb/test/clock?requestedDate=2021-09-07&quot;</span></code></pre></div></div></li><li><p>Move clock +8 day (<code>2021-09-15</code>) and observe second payment retry.</p></li><li><p>Move clock +1 day (<code>2021-09-16</code>) and verify that the account is in <code>WARNING</code> status.</p></li><li><p>Move clock +3 day (<code>2021-09-19</code>) and observe third payment retry.</p></li><li><p>Move clock +1 day (<code>2021-09-20</code>) and verify that the account is in <code>BLOCKED</code> status.</p></li><li><p>Move clock +1 day (<code>2021-09-21</code>) and configure the payment plugin to succeed:</p><div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="bash"><span></span>curl -v <span class="tok-se">\</span>
-u<span class="tok-s1">&#39;admin:password&#39;</span> <span class="tok-se">\</span>
-H <span class="tok-s2">&quot;X-Killbill-ApiKey: bob&quot;</span> <span class="tok-se">\</span>
-H <span class="tok-s1">&#39;X-Killbill-ApiSecret: lazar&#39;</span> <span class="tok-se">\</span>
-H <span class="tok-s2">&quot;Content-Type: application/json&quot;</span> <span class="tok-se">\</span>
-H <span class="tok-s1">&#39;X-Killbill-CreatedBy: demo&#39;</span> <span class="tok-se">\</span>
-X POST <span class="tok-se">\</span>
--data-binary <span class="tok-s1">&#39;{&quot;CONFIGURE_ACTION&quot;:&quot;ACTION_CLEAR&quot;}&#39;</span> <span class="tok-se">\</span>
 -v <span class="tok-s1">&#39;http://127.0.0.1:8080/plugins/killbill-payment-test/configure&#39;</span></code></pre></div></div></li><li><p>Move clock +5 day (<code>2021-09-26</code>) and observe the final payment retry. Verify that the payment is successful and the account is moved to the <code>GOOD</code> status.</p></li></ol></div></div></div>
<div class="sect1"><h2 id="_default_payment_retry_schedule_and_overdue_configuration">Default Payment Retry Schedule and Overdue Configuration</h2><div class="sectionbody"><div class="paragraph"><p>Even if the payment retry schedule is not configured explicitly, there is a default schedule of <code>8,8,8</code>. This means that a first retry would happen 8 days after the initial failure, and then if the first retry attempt failed, another attempt would be scheduled 8 days later and then finally a last one 8 days after that.</p></div>
<div class="paragraph"><p>If the overdue XML is not configured explicitly, there is a default overdue XML as specified <a href="https://github.com/killbill/killbill/blob/29762c013855f7e105861eecd6d5cb393ef98cb8/overdue/src/main/resources/NoOverdueConfig.xml"><em>here</em></a>. However, this does not do anything. So, even if a user has unpaid invoices, the user&#8217;s account will not be overdue.</p></div></div></div>
<div class="sect1"><h2 id="_more_about_overdue_configuration_file">More About Overdue Configuration File</h2><div class="sectionbody"><div class="paragraph"><p>Earlier, we have taken a look at a basic overdue configuration file. This section provides more details about the contents of this file.</p></div>
<div class="sect2"><h3 id="_overdue_state_information">Overdue State Information</h3><div class="paragraph"><p>At its core, the overdue configuration file contains a list of the various states that a customer&#8217;s account may go through if the customer does not pay. Each state includes the information listed in the table below.</p></div>
<table class="tableblock frame-all grid-all" style="width: 75%;"><colgroup><col style="width: 25%;"><col style="width: 25%;"><col style="width: 25%;"><col style="width: 25%;"></colgroup><tbody><tr><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p><strong>Information</strong></p></div></div></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p><strong>Type</strong></p></div></div></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p><strong>Description</strong></p></div></div></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p><strong>Example</strong></p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>name</p></div></div></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>Attribute on <code>state</code> tag</p></div></div></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>Name given to the state</p></div></div></td><td class="tableblock halign-left valign-top"><div><div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="xml"><span></span><span class="tok-nt">&lt;state</span> <span class="tok-na">name=</span><span class="tok-s">&quot;WARNING&quot;</span><span class="tok-nt">&gt;</span></code></pre></div></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>condition</p></div></div></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>Tag within <code>state</code></p></div></div></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>Specifies the condition to be evaluated. The account will enter this overdue state only if the condition evaluates to true.</p></div></div></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>See <a href="#overdue_conditions">"Overdue Conditions"</a></p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>externalMessage</p></div></div></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>Tag within <code>state</code></p></div></div></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>Optional message which can be retrieved by plugins listening to overdue events, and displayed to the user. Any String value can be specified</p></div></div></td><td class="tableblock halign-left valign-top"><div><div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="xml"><span></span><span class="tok-nt">&lt;externalMessage&gt;</span>
Reached WARNING
<span class="tok-nt">&lt;/externalMessage&gt;</span></code></pre></div></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>subscriptionCancellation<br>
Policy</p></div></div></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>Tag within <code>state</code></p></div></div></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>Specifies whether or not to cancel the subscriptions associated with the account (and the cancellation policy that should be used) when this overdue state is reached. Possible values are <code>NONE</code>, <code>IMMEDIATE</code>, <code>END_OF_TERM</code>)</p></div></div></td><td class="tableblock halign-left valign-top"><div><div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="xml"><span></span><span class="tok-nt">&lt;subscriptionCancellationPolicy&gt;</span>
END_OF_TERM
<span class="tok-nt">&lt;/subscriptionCancellationPolicy&gt;</span>`</code></pre></div></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>blockChanges</p></div></div></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>Tag within <code>state</code></p></div></div></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>Specifies whether the customer is allowed to make any plan change on the subscriptions when this overdue state is reached. A true/false value needs to be specified.</p></div></div></td><td class="tableblock halign-left valign-top"><div><div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="xml"><span></span><span class="tok-nt">&lt;blockChanges&gt;</span>
true
<span class="tok-nt">&lt;/blockChanges&gt;</span></code></pre></div></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>disableEntitlement<br>
AndChangesBlocked</p></div></div></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>Tag within <code>state</code></p></div></div></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>Specifies whether the subscriptions should be paused (which means entitlement and billing will be disabled and changes will be blocked) when this overdue state is reached. A true/false value needs to be specified.</p></div></div></td><td class="tableblock halign-left valign-top"><div><div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="xml"><span></span><span class="tok-nt">&lt;disableEntitlementAndChangesBlocked&gt;</span>
true
<span class="tok-nt">&lt;/disableEntitlementAndChangesBlocked&gt;</span></code></pre></div></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>autoReevaluation<br>
Interval</p></div></div></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>Tag within <code>state</code></p></div></div></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>Specifies the duration after which the overdue state should be reevaluated. The duration needs to be specified with a <code>unit</code> (one of <code>DAYS</code>, <code>WEEKS</code>, <code>MONTHS</code>, <code>YEARS</code>, <code>UNLIMITED</code>) and an integer value.</p></div></div></td><td class="tableblock halign-left valign-top"><div><div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="xml"><span></span><span class="tok-nt">&lt;autoReevaluationInterval&gt;</span>
<span class="tok-nt">&lt;unit&gt;</span>DAYS<span class="tok-nt">&lt;/unit&gt;</span>
<span class="tok-nt">&lt;number&gt;</span>4<span class="tok-nt">&lt;/number&gt;</span>
<span class="tok-nt">&lt;/autoReevaluationInterval&gt;</span></code></pre></div></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>isClearState</p></div></div></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>Tag within <code>state</code></p></div></div></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>Specifies whether the current state is a clear state. A true/false value needs to be specified.</p></div></div></td><td class="tableblock halign-left valign-top"><div><div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="xml"><span></span><span class="tok-nt">&lt;isClearState&gt;</span>true<span class="tok-nt">&lt;/isClearState&gt;</span></code></pre></div></div></div></td></tr></tbody></table></div>
<div class="sect2"><h3 id="overdue_conditions">Overdue Conditions</h3><div class="paragraph"><p>The following table lists the various overdue conditions. Note that it is also possible to combine multiple conditions in which case <em>ALL</em> the specified conditions need to evaluate to true for the account to enter the particular overdue state.</p></div>
<table class="tableblock frame-all grid-all spread"><colgroup><col style="width: 33.3333%;"><col style="width: 33.3333%;"><col style="width: 33.3334%;"></colgroup><tbody><tr><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p><strong>Condition</strong></p></div></div></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p><strong>Description</strong></p></div></div></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p><strong>Example</strong></p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>numberOfUnpaid<br>
InvoicesEqualsOrExceeds</p></div></div></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>Specifies that the overdue flow should kick in when the number of unpaid invoices equals or exceeds the specified value. An integer value needs to be specified.</p></div></div></td><td class="tableblock halign-left valign-top"><div><div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="xml"><span></span><span class="tok-nt">&lt;condition&gt;</span>
<span class="tok-nt">&lt;numberOfUnpaidInvoicesEqualsOrExceeds&gt;</span>2
<span class="tok-nt">&lt;/numberOfUnpaidInvoicesEqualsOrExceeds&gt;</span>
<span class="tok-nt">&lt;/condition&gt;</span></code></pre></div></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>totalUnpaidInvoice<br>
BalanceEqualsOrExceeds</p></div></div></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>Specifies that the overdue flow should kick in when the total unpaid invoice balance equals or exceeds the specified value. A decimal value needs to be specified.</p></div></div></td><td class="tableblock halign-left valign-top"><div><div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="xml"><span></span><span class="tok-nt">&lt;condition&gt;</span>
  <span class="tok-nt">&lt;totalUnpaidInvoiceBalanceEqualsOrExceeds&gt;</span>1.00
   <span class="tok-nt">&lt;/totalUnpaidInvoiceBalanceEqualsOrExceeds&gt;</span>
<span class="tok-nt">&lt;/condition&gt;</span></code></pre></div></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>timeSinceEarliestUnpaid<br>
InvoiceEqualsOrExceeds</p></div></div></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>Specifies that the overdue flow should kick in when the specified duration has elapsed since the last unpaid invoice. The duration needs to be specified with a <code>unit</code> (one of <code>DAYS</code>, <code>WEEKS</code>, <code>MONTHS</code>, <code>YEARS</code>, <code>UNLIMITED</code>) and an integer value</p></div></div></td><td class="tableblock halign-left valign-top"><div><div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="xml"><span></span><span class="tok-nt">&lt;condition&gt;</span>
  <span class="tok-nt">&lt;timeSinceEarliestUnpaidInvoiceEqualsOrExceeds&gt;</span>
    <span class="tok-nt">&lt;unit&gt;</span>DAYS<span class="tok-nt">&lt;/unit&gt;</span>
    <span class="tok-nt">&lt;number&gt;</span>10<span class="tok-nt">&lt;/number&gt;</span>
  <span class="tok-nt">&lt;/timeSinceEarliestUnpaidInvoiceEqualsOrExceeds&gt;</span>
<span class="tok-nt">&lt;/condition&gt;</span></code></pre></div></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>controlTagInclusion</p></div></div></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>Specifies that the overdue flow should kick in when the account is tagged with the specified control tag.</p></div></div></td><td class="tableblock halign-left valign-top"><div><div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="xml"><span></span><span class="tok-nt">&lt;condition&gt;</span>
  <span class="tok-nt">&lt;controlTagInclusion&gt;</span>TEST
  <span class="tok-nt">&lt;/controlTagInclusion&gt;</span>
<span class="tok-nt">&lt;/condition&gt;</span></code></pre></div></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>controlTagExclusion</p></div></div></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>Specifies that the overdue flow should kick in when the account is NOT tagged with the specified control tag.</p></div></div></td><td class="tableblock halign-left valign-top"><div><div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="xml"><span></span><span class="tok-nt">&lt;condition&gt;</span>
  <span class="tok-nt">&lt;controlTagExclusion&gt;</span>TEST
  <span class="tok-nt">&lt;/controlTagExclusion&gt;</span>
<span class="tok-nt">&lt;/condition&gt;</span></code></pre></div></div></div></td></tr></tbody></table></div>
<div class="sect2"><h3 id="_other_important_tags">Other Important Tags</h3><div class="ulist"><ul><li><p><code>initialReevaluationInterval</code> - Top level tag. Specifies the duration after which the overdue system should first kick in. The duration needs to be specified with a <code>unit</code> (one of <code>DAYS</code>, <code>WEEKS</code>, <code>MONTHS</code>, <code>YEARS</code>, <code>UNLIMITED</code>) and an integer value.</p></li></ul></div>
<div class="paragraph"><p>Example:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="xml"><span></span><span class="tok-nt">&lt;initialReevaluationInterval&gt;</span>
  <span class="tok-nt">&lt;unit&gt;</span>DAYS<span class="tok-nt">&lt;/unit&gt;</span>
  <span class="tok-nt">&lt;number&gt;</span>5<span class="tok-nt">&lt;/number&gt;</span>
<span class="tok-nt">&lt;/initialReevaluationInterval&gt;</span></code></pre></div></div></div>
<div class="sect2"><h3 id="_some_sample_overdue_configurations">Some Sample Overdue Configurations</h3><div class="paragraph"><p>The following are some sample <code>overdue.xml</code> files:</p></div>
<div class="ulist"><ul><li><p><a href="https://github.com/killbill/killbill-docs/tree/9ada1c053cb4e3dae9ded7f8b2bb311fff59375e/overdue-configurations/overdueWithNumberOfUnpaidInvoicesCondition.xml">overdueWithNumberOfUnpaidInvoicesCondition.xml</a></p></li><li><p><a href="https://github.com/killbill/killbill-docs/tree/9ada1c053cb4e3dae9ded7f8b2bb311fff59375e/overdue-configurations/overdueWithTotalUnpaidInvoiceBalanceCondition.xml">overdueWithTotalUnpaidInvoiceBalanceCondition.xml</a></p></li><li><p><a href="https://github.com/killbill/killbill-docs/tree/9ada1c053cb4e3dae9ded7f8b2bb311fff59375e/overdue-configurations/overdueWithControlTag.xml">overdueWithControlTag.xml</a></p></li><li><p><a href="https://github.com/killbill/killbill-docs/tree/9ada1c053cb4e3dae9ded7f8b2bb311fff59375e/overdue-configurations/overdueWithExclusionControlTag.xml">overdueWithExclusionControlTag.xml</a></p></li><li><p><a href="https://github.com/killbill/killbill-docs/tree/9ada1c053cb4e3dae9ded7f8b2bb311fff59375e/overdue-configurations/overdueWithMultipleConditions.xml">overdueWithMultipleConditions.xml</a></p></li></ul></div></div>
<div class="sect2"><h3 id="_overdue_xml_validation">Overdue.xml Validation</h3><div class="paragraph"><p>The <code>overdue.xml</code> file can be validated using the <code>overdue.xsd</code> file available <a href="https://docs.killbill.io/latest/overdue.xsd">here</a>.</p></div></div></div></div>
<div class="sect1"><h2 id="platform_use">Use of the Platform</h2><div class="sectionbody"><div class="sect2"><h3 id="_use_of_the_apis">Use of the APIs</h3><div class="paragraph"><p>When a customer attempts to use the service, the web site <strong>could</strong> verify if the customer is entitled to receive the service:</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>It should first retrieve the overdue status (at the account level) using the <code>GET /1.0/kb/accounts/{accountId}/overdue</code> api</p></li><li><p>It should then retrieve the subscriptions associated with the account <code>GET /1.0/kb/accounts/{accountId}/bundles</code> (or if the subscriptionId was cached it could use <code>GET /1.0/kb/subscriptions/{subscriptionId}</code>) to verify the individual subscriptions status</p></li></ol></div>
<div class="paragraph"><p>The endpoint <code>GET /1.0/kb/accounts/{accountId}/overdue</code> will return the following json:</p></div>
<div class="listingblock"><div class="content"><pre class="pygments highlight"><code data-lang="json"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;blockChanges&quot;</span><span class="tok-p">:</span> <span class="tok-kc">true</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;clearState&quot;</span><span class="tok-p">:</span> <span class="tok-kc">false</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;daysBetweenPaymentRetries&quot;</span><span class="tok-p">:</span> <span class="tok-mi">1</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;disableEntitlementAndChangesBlocked&quot;</span><span class="tok-p">:</span> <span class="tok-kc">false</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;externalMessage&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;Reached WARNING&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;WARNING&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;reevaluationIntervalDays&quot;</span><span class="tok-p">:</span> <span class="tok-mi">4</span>
<span class="tok-p">}</span></code></pre></div></div>
<div class="paragraph"><p>If the <code>disableEntitlementAndChangesBlocked</code> is set to true, it means that the customer is not entitled to the service associated to any subscriptions.</p></div>
<div class="paragraph"><p>Note that retrieving subscriptions through the <code>GET /1.0/kb/subscriptions/{subscriptionId}</code> will not directly indicate the overdue status, and so both calls must be made to have a complete picture of the entitlement when the overdue system has been configured.</p></div>
<div class="paragraph"><p>When retrieving entitlement/overdue status, the web site could be implemented to take all kinds of actions such as displaying warning message, degrading experience, emailing customer, &#8230;&#8203;</p></div></div>
<div class="sect2"><h3 id="_custom_plugins">Custom Plugins</h3><div class="paragraph"><p>In the previous section, we discussed a possible implementation where the web site queries the billing system to figure out the entitlement story attached to a customer (when he logs-in for instance). Another pattern is to create a custom notification plugin that will listen to <code>Overdue</code> events and take appropriate action. The plugin would need to handle the <code>OVERDUE_CHANGE</code> event.</p></div>
<div class="paragraph"><p>We have a <a href="https://docs.killbill.io/latest/notification_plugin.html">tutorial</a> that demonstrates how to create a notification plugin in Java. We also have a sample <a href="https://github.com/killbill/killbill-hello-world-ruby-plugin/blob/master/lib/helloworld/user_listener.rb">Ruby notification plugin</a> that can be used to create a notification plugin in Ruby.</p></div>
<div class="paragraph"><p>Such plugins can be used for the following purpose:</p></div>
<div class="ulist"><ul><li><p>Email/Notify user about the new state (We already have a Java  <a href="https://github.com/killbill/killbill-email-notifications-plugin">email notification plugin</a> which can be extended to handle <code>OVERDUE_CHANGE</code> events)</p></li><li><p>Take action to modify the experience (based on the state name): for instance to degrade the service, modify the login flow to prompt for payment, &#8230;&#8203;</p></li></ul></div></div></div></div>
<div class="sect1"><h2 id="_additional_resources">Additional Resources</h2><div class="sectionbody"><div class="ulist"><ul><li><p><a href="https://docs.killbill.io/latest/userguide_subscription.html">Subscription Billing User Guide</a></p></li><li><p><a href="https://docs.killbill.io/latest/userguide_configuration.html">Kill Bill Configuration Guide</a></p></li></ul></div></div></div></div></article></div><div class="col-12 col-md-3 col-xl-2"><nav class="bd-links toc right-side-menu" id="toc" data-toggle="toc"></nav></div></div></div></main><script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script><script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"></script><script src="https://cdn.staticaly.com/gh/afeld/bootstrap-toc/v1.0.0/dist/bootstrap-toc.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3"></script><script src="https://www.googletagmanager.com/gtag/js?id=G-C0HVJ1E78Z"></script><script>
    setTimeout(function(){
      $('.content-wrapper h2, .content-wrapper h3, .content-wrapper h4').append('<a href=""><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>');
      $('.content-wrapper h2, .content-wrapper h3, .content-wrapper h4').each(function(){
        let itemHref = '#' + $(this).attr('id');
        $(this).find('a').attr("href", itemHref);
      })
      $('.content-wrapper table').each(function() {
        $(this).wrap('<div class="table-wrap"></div>')
        $('.table-wrap').each(function() {
          if ($(this).find('table').width() > $(this).width()){
            $(this).css('max-width', '100%');
            $(this).css('overflow-x', 'scroll');
          }
        })
      })
      function copyToClipboard(text) {
        let sampleTextarea = document.createElement("textarea");
        document.body.appendChild(sampleTextarea);
        sampleTextarea.value = text;
        sampleTextarea.select();
        document.execCommand("copy");
        document.body.removeChild(sampleTextarea);
      }
      $('.content-wrapper h2 a, .content-wrapper h3 a, .content-wrapper h4 a').on('click', function(){
        setTimeout(function(){
          copyToClipboard($(location).attr("href"));
        }, 500);  
      });
      $('.content-wrapper .note td.icon').append('<img src="https://github.com/killbill/killbill-docs/raw/v3/userguide/assets/img/note-icon.png">')
    }, 1000);
  </script><script>docsearch({apiKey: '3ef227e7fd5e2e1a3fffd880484934bf', container: '#docsearch', appId: 'S2ISXITURI', indexName: 'killbill'});</script><script>window.dataLayer = window.dataLayer || [];
function gtag(){window.dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-C0HVJ1E78Z');</script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create','UA-32705710-3','auto');
  ga('send','pageview');
  var getOutboundLink = function(url) {
    ga('send', {
      hitType: 'event',
      eventCategory: 'outbound',
      eventAction: 'click',
      eventLabel: url,
      hitCallback: function(){document.location = url;}
    });
  }</script></body></html>